<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta property="telegram:channel_post_button" content="Заказать">
  <title>Кофейни Кирова</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <!-- Упрощенная загрузка API Яндекс Карт с явным указанием всех необходимых модулей -->
  <script src="https://api-maps.yandex.ru/2.1/?apikey=5bf4679c-bab1-47e8-993a-b0b739f0acbe&lang=ru_RU" type="text/javascript"></script>
  
  <!-- Contact functions -->
  <script>
    // Initialize contact functions when DOM is loaded
    document.addEventListener('DOMContentLoaded', function() {
      // Show contact options
      window.showContactOptions = function() {
        console.log('Showing contact options');
        const overlay = document.getElementById('contactOverlay');
        const options = document.getElementById('contactOptions');
        if (overlay && options) {
          overlay.classList.add('visible');
          options.classList.add('visible');
        } else {
          console.error('Contact elements not found:', {
            overlay: overlay ? 'exists' : 'missing',
            options: options ? 'exists' : 'missing'
          });
        }
      };

      // Hide contact options
      window.hideContactOptions = function() {
        console.log('Hiding contact options');
        const overlay = document.getElementById('contactOverlay');
        const options = document.getElementById('contactOptions');
        if (overlay && options) {
          overlay.classList.remove('visible');
          options.classList.remove('visible');
        }
      };

      // Open sidebar
      window.openSidebar = function() {
        console.log('Opening sidebar');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        if (sidebar && overlay) {
          sidebar.classList.add('visible');
          overlay.classList.add('visible');
          showMainMenu(); // Show main menu when opening sidebar
        }
      };

      // Close sidebar
      window.closeSidebar = function() {
        console.log('Closing sidebar');
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        if (sidebar && overlay) {
          sidebar.classList.remove('visible');
          overlay.classList.remove('visible');
        }
      };
    });
  </script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    }
    
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    
    #app {
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
    }
    
    #map {
      width: 100%;
      flex-grow: 1;
      position: relative;
    }
    
    .header {
      padding: 12px 16px;
      background-color: var(--tg-theme-bg-color, #ffffff);
      color: var(--tg-theme-text-color, #000000);
      border-bottom: 1px solid var(--tg-theme-hint-color, #999999);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .title {
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      position: relative;
      display: flex;
      align-items: center;
    }
    
    .title::after {
      content: '';
      display: inline-block;
      width: 0;
      height: 0;
      border-left: 5px solid transparent;
      border-right: 5px solid transparent;
      border-top: 5px solid var(--tg-theme-text-color, #000000);
      margin-left: 6px;
    }
    
    .title-dropdown {
      position: absolute;
      top: 100%;
      left: 0;
      background-color: var(--tg-theme-bg-color, #ffffff);
      border: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      z-index: 1000;
      min-width: 200px;
      display: none;
    }
    
    .title-dropdown.visible {
      display: block;
    }
    
    .dropdown-item {
      padding: 12px 16px;
      cursor: pointer;
    }
    
    .dropdown-item:hover {
      background-color: var(--tg-theme-secondary-bg-color, rgba(0, 0, 0, 0.05));
    }
    
    .dropdown-item.active {
      font-weight: 600;
      color: var(--tg-theme-button-color, #2481cc);
    }
    
    .count {
      font-size: 14px;
      color: var(--tg-theme-hint-color, #999999);
    }

    .search-container {
      position: relative;
      flex: 1;
      max-width: 300px;
      margin: 0 15px;
    }

    .search-input {
      width: 100%;
      padding: 8px 30px 8px 12px;
      border: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.2));
      border-radius: 8px;
      font-size: 14px;
      background-color: var(--tg-theme-bg-color, #ffffff);
      color: var(--tg-theme-text-color, #000000);
    }

    .search-input:focus {
      outline: none;
      border-color: var(--tg-theme-button-color, #2481cc);
    }

    .clear-search {
      position: absolute;
      right: 8px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--tg-theme-hint-color, #8e8e93);
      font-size: 18px;
      cursor: pointer;
      padding: 0;
      width: 20px;
      height: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .search-active .search-input {
      background-color: rgba(36, 129, 204, 0.05);
    }

    .search-highlight {
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.6; }
      100% { opacity: 1; }
    }
    
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      z-index: 1000;
    }
    
    .error {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: #ff3b30;
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      z-index: 1000;
      max-width: 90%;
      text-align: center;
    }

    .success {
      position: absolute;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: var(--tg-theme-button-color, #2481cc);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      z-index: 1000;
      max-width: 90%;
      text-align: center;
    }
    
    .nearest {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background-color: var(--tg-theme-button-color, #2481cc);
      color: var(--tg-theme-button-text-color, #ffffff);
      padding: 12px;
      border-radius: 50%;
      z-index: 1000;
      width: 56px;
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
      border: none;
      cursor: pointer;
    }
    
    .nearest svg {
      width: 24px;
      height: 24px;
      fill: currentColor;
    }
    
    .info-panel {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      background-color: var(--tg-theme-bg-color, #ffffff);
      color: var(--tg-theme-text-color, #000000);
      padding: 12px 16px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      z-index: 1000;
      display: none;
    }
    
    .info-panel.visible {
      display: block;
    }
    
    .info-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .info-address {
      font-size: 14px;
      color: var(--tg-theme-hint-color, #8e8e93);
      margin-bottom: 4px;
    }
    
    .info-hours {
      font-size: 14px;
      color: var(--tg-theme-hint-color, #8e8e93);
      margin-bottom: 8px;
    }
    
    .info-distance {
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 12px;
    }
    
    .info-button {
      background-color: var(--tg-theme-button-color, #2481cc);
      color: var(--tg-theme-button-text-color, #ffffff);
      border: none;
      border-radius: 8px;
      padding: 8px 12px;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .info-button svg {
      width: 16px;
      height: 16px;
      margin-right: 6px;
    }
    
    .hidden {
      display: none !important;
    }
    
    /* Pre-order form styles */
    #preorderOverlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 2000;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
    }
    
    .preorder-form {
      background-color: var(--tg-theme-bg-color, #ffffff);
      color: var(--tg-theme-text-color, #000000);
      border-radius: 12px;
      width: 100%;
      max-width: 350px;
      max-height: 85vh;
      overflow-y: auto;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      position: relative;
    }
    
    .preorder-header {
      padding: 12px 16px;
      border-bottom: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      position: sticky;
      top: 0;
      background-color: var(--tg-theme-bg-color, #ffffff);
      z-index: 1;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .preorder-title-container {
      flex: 1;
    }
    
    .preorder-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 2px;
    }
    
    .preorder-subtitle {
      font-size: 13px;
      color: var(--tg-theme-hint-color, #8e8e93);
    }
    
    #closeButton {
      background: none;
      border: none;
      color: var(--tg-theme-hint-color, #8e8e93);
      font-size: 24px;
      cursor: pointer;
      width: 30px;
      height: 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0;
      margin-left: 10px;
    }
    
    .preorder-content {
      padding: 12px;
    }
    
    .menu-section {
      margin-bottom: 20px;
      border: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      border-radius: 8px;
      overflow: hidden;
    }
    
    .menu-section-header {
      padding: 12px 16px;
      background-color: var(--tg-theme-bg-color, #ffffff);
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      user-select: none;
    }
    
    .menu-section-header:hover {
      background-color: var(--tg-theme-secondary-bg-color, rgba(0, 0, 0, 0.05));
    }
    
    .menu-section-title {
      font-size: 15px;
      font-weight: 600;
      display: flex;
      align-items: center;
    }
    
    .menu-section-arrow {
      width: 20px;
      height: 20px;
      transition: transform 0.3s ease;
    }
    
    .menu-section-arrow svg {
      width: 100%;
      height: 100%;
    }
    
    .menu-section.collapsed .menu-section-arrow {
      transform: rotate(-90deg);
    }
    
    .menu-section-content {
      max-height: 1000px;
      transition: max-height 0.3s ease;
      overflow: hidden;
    }
    
    .menu-section.collapsed .menu-section-content {
      max-height: 0;
    }
    
    .menu-items {
      padding: 12px;
    }
    
    /* Time slider styles */
    .time-slider-container {
      margin: 0;
      padding: 12px;
      background: none;
      border: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      border-radius: 8px;
    }

    .category-content {
      padding: 0;
    }

    .menu-items {
      margin: 0;
      padding: 0;
    }

    .time-slider {
      width: 100%;
      height: 2px;
      -webkit-appearance: none;
      appearance: none;
      cursor: pointer;
      margin: 0;
      padding: 0;
      background: none !important;
      border: none;
    }

    .time-slider::-webkit-slider-runnable-track {
      width: 100%;
      height: 1px;
      background: var(--tg-theme-hint-color, rgba(0, 0, 0, 0.15));
      border: none;
      border-radius: 0;
    }

    .time-slider::-moz-range-track {
      width: 100%;
      height: 1px;
      background: var(--tg-theme-hint-color, rgba(0, 0, 0, 0.15));
      border: none;
      border-radius: 0;
    }

    .time-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 12px;
      height: 12px;
      background: var(--tg-theme-button-color, #2481cc);
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid #fff;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      margin-top: -5.5px;
    }

    .time-slider::-moz-range-thumb {
      width: 12px;
      height: 12px;
      background: var(--tg-theme-button-color, #2481cc);
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid #fff;
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
      margin-top: -5.5px;
    }

    .time-slider:focus {
      outline: none;
    }

    /* Обновляем стили категорий */
    #drinksCategory .menu-items,
    #dessertsCategory .menu-items,
    #sandwichesCategory .menu-items,
    #icecreamCategory .menu-items,
    #colddrinksCategory .menu-items {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      padding: 12px;
      flex: 1 1 auto;
      min-height: 0;
      margin: 0;
    }

    .menu-item {
      position: relative;
      overflow: hidden;
      border-radius: 16px;
      background: linear-gradient(145deg, #ffffff 0%, #f5f5f5 100%);
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .menu-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.15);
    }

    .menu-item-image {
      width: 100%;
      height: 120px;
      object-fit: contain;
      object-position: center;
      border-radius: 8px;
      background-color: #f5f5f5;
    }

    .menu-item-content {
      padding: 8px;
    }

    .menu-item-title {
      font-weight: 500;
      font-size: 14px;
      color: var(--tg-theme-text-color, #000000);
    }

    .menu-item-price {
      font-weight: 600;
      color: #2481cc;
    }

    .menu-item-footer {
      margin-top: auto;
      padding-top: 4px;
    }

    .menu-item.selected {
      border-color: var(--tg-theme-button-color, #2481cc);
      background-color: rgba(36, 129, 204, 0.05);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
    }

    .volume-select {
      width: 100%;
      padding: 4px 6px;
      border: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      border-radius: 6px;
      font-size: 12px;
      background-color: var(--tg-theme-bg-color, #ffffff);
      color: var(--tg-theme-text-color, #000000);
      cursor: pointer;
      margin: 0;
    }

    .time-slider-wrapper {
      background: none;
      padding: 0;
      margin: 0;
    }

    .time-slider-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
      font-size: 13px;
      color: var(--tg-theme-text-color, #000000);
    }

    #timeValue {
      font-weight: 500;
      color: var(--tg-theme-button-color, #2481cc);
    }

    .time-marks {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 2px;
      padding: 0 7px;
    }

    .time-mark {
      font-size: 11px;
      color: var(--tg-theme-hint-color, rgba(0, 0, 0, 0.3));
    }
    
    .time-slider-value {
      font-weight: 600;
      font-size: 13px;
      color: var(--tg-theme-button-color, #2481cc);
    }
    
    .menu-item {
      border: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      border-radius: 8px;
      padding: 10px;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 8px;
      background: none;
    }
    
    .menu-item.selected {
      border-color: var(--tg-theme-button-color, #2481cc);
      background-color: rgba(36, 129, 204, 0.05);
    }
    
    .menu-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .menu-item-info {
      flex: 1;
    }
    
    .menu-item-title {
      font-weight: 500;
      margin-bottom: 2px;
      font-size: 14px;
    }
    
    .menu-item-price {
      font-size: 13px;
      color: var(--tg-theme-hint-color, #8e8e93);
    }

    .volume-select {
      width: 110px;
      padding: 4px 8px;
      border: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      border-radius: 6px;
      font-size: 13px;
      background-color: var(--tg-theme-bg-color, #ffffff);
      color: var(--tg-theme-text-color, #000000);
      cursor: pointer;
    }
    
    .volume-select:focus {
      outline: none;
      border-color: var(--tg-theme-button-color, #2481cc);
    }
    
    .form-group {
      margin-bottom: 14px;
    }
    
    .form-label {
      display: block;
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 6px;
    }
    
    .form-input {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      border-radius: 8px;
      font-size: 14px;
      background-color: var(--tg-theme-bg-color, #ffffff);
      color: var(--tg-theme-text-color, #000000);
    }
    
    .form-input:focus {
      outline: none;
      border-color: var(--tg-theme-button-color, #2481cc);
    }
    
    .form-select {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      border-radius: 8px;
      font-size: 14px;
      background-color: var(--tg-theme-bg-color, #ffffff);
      color: var(--tg-theme-text-color, #000000);
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: right 10px center;
      background-size: 14px;
    }
    
    .form-select:focus {
      outline: none;
      border-color: var(--tg-theme-button-color, #2481cc);
    }
    
    .form-footer {
      padding: 12px 16px;
      border-top: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      bottom: 0;
      background-color: var(--tg-theme-bg-color, #ffffff);
    }
    
    .total-price {
      font-weight: 600;
      font-size: 15px;
    }
    
    .submit-button {
      background-color: var(--tg-theme-button-color, #2481cc);
      color: var(--tg-theme-button-text-color, #ffffff);
      border: none;
      border-radius: 8px;
      padding: 8px 14px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
    }
    
    .submit-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    
    .order-success {
      text-align: center;
      padding: 24px 16px;
    }
    
    .success-icon {
      width: 56px;
      height: 56px;
      margin: 0 auto 14px;
      background-color: #34c759;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .success-icon svg {
      width: 28px;
      height: 28px;
      fill: white;
    }
    
    .success-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .success-message {
      font-size: 14px;
      color: var(--tg-theme-hint-color, #8e8e93);
      margin-bottom: 20px;
    }
    
    .success-button {
      background-color: var(--tg-theme-button-color, #2481cc);
      color: var(--tg-theme-button-text-color, #ffffff);
      border: none;
      border-radius: 8px;
      padding: 8px 14px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
    }
    
    /* Custom balloon content */
    .custom-balloon {
      padding: 8px;
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
      max-width: 150px;
    }

    .balloon-image {
      margin: -8px -8px 6px -8px;
      overflow: hidden;
    }

    .balloon-image img {
      display: block;
      width: calc(100% + 16px);
      height: 75px;
      object-fit: cover;
      border-radius: 8px 8px 0 0;
    }

    .balloon-title {
      font-size: 14px;
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--tg-theme-text-color, #000000);
    }
    
    .balloon-address {
      font-size: 12px;
      color: var(--tg-theme-hint-color, #8e8e93);
      margin-bottom: 4px;
    }
    
    .balloon-hours {
      font-size: 12px;
      color: var(--tg-theme-hint-color, #8e8e93);
      margin-bottom: 4px;
    }
    
    .balloon-distance {
      font-size: 12px;
      font-weight: 500;
      margin-bottom: 6px;
      color: var(--tg-theme-text-color, #000000);
    }
    
    .balloon-button {
      background-color: var(--tg-theme-button-color, #2481cc);
      color: var(--tg-theme-button-text-color, #ffffff);
      border: none;
      border-radius: 6px;
      padding: 6px 8px;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .balloon-button svg {
      width: 12px;
      height: 12px;
      margin-right: 4px;
    }
    
    .close-button-container {
      text-align: center;
      margin-top: 16px;
    }
    
    .close-button {
      background-color: #ff3b30;
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      font-size: 15px;
      font-weight: 500;
      cursor: pointer;
    }

    .location-accuracy {
      position: absolute;
      bottom: 85px;
      left: 20px;
      background-color: rgba(0, 0, 0, 0.7);
      color: white;
      padding: 6px 10px;
      border-radius: 16px;
      font-size: 12px;
      z-index: 999;
      display: none;
    }

    .location-accuracy.visible {
      display: block;
    }

    /* Стили для бокового меню */
    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 3000;
      display: none;
    }

    .sidebar-overlay.visible {
      display: block;
    }

    .sidebar {
      position: fixed;
      top: 0;
      left: -300px;
      width: 300px;
      height: 100%;
      background-color: var(--tg-theme-bg-color, #ffffff);
      color: var(--tg-theme-text-color, #000000);
      z-index: 3001;
      overflow-y: auto;
      transition: left 0.3s ease;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
    }

    .sidebar.visible {
      left: 0;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      padding: 16px;
      border-bottom: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      position: relative;
    }

    .sidebar-back {
      position: absolute;
      left: 16px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
      color: var(--tg-theme-hint-color, #8e8e93);
    }

    .sidebar-title {
      flex: 1;
      text-align: center;
      font-size: 18px;
      font-weight: 600;
    }

    .sidebar-close {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
      color: var(--tg-theme-hint-color, #8e8e93);
      font-size: 24px;
    }

    .user-avatar {
      width: 48px;
      height: 48px;
      border-radius: 50%;
      overflow: hidden;
      background-color: var(--tg-theme-secondary-bg-color, rgba(0, 0, 0, 0.05));
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .user-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .user-avatar svg {
      width: 32px;
      height: 32px;
    }

    .user-info {
      flex: 1;
    }

    .user-name {
      font-weight: 600;
      font-size: 16px;
      color: var(--tg-theme-text-color, #000000);
      margin-bottom: 4px;
    }

    .user-phone {
      font-size: 14px;
      color: var(--tg-theme-hint-color, #999999);
      margin-bottom: 2px;
    }

    .user-id {
      font-size: 12px;
      color: var(--tg-theme-hint-color, #999999);
    }

    .menu-list {
      padding: 16px;
      border-bottom: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
    }

    .menu-item-sidebar {
      display: flex;
      align-items: center;
      padding: 12px 0;
      cursor: pointer;
    }

    .menu-item-sidebar:not(:last-child) {
      border-bottom: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.05));
    }

    .menu-icon {
      width: 32px;
      height: 32px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 16px;
    }

    .menu-icon.orders {
      background-color: #4CD964;
    }

    .menu-icon.balance {
      background-color: #5856D6;
    }

    .menu-icon.referral {
      background-color: #FF9500;
    }

    .menu-icon svg {
      width: 18px;
      height: 18px;
      fill: white;
    }

    .menu-text {
      flex: 1;
      font-size: 16px;
    }

    .menu-value {
      font-size: 16px;
      font-weight: 600;
      color: var(--tg-theme-hint-color, #8e8e93);
    }

    .menu-arrow {
      margin-left: 8px;
      color: var(--tg-theme-hint-color, #8e8e93);
    }

    .legal-links {
      padding: 16px;
    }

    .legal-link {
      padding: 12px 0;
      font-size: 16px;
      color: var(--tg-theme-text-color, #000000);
      cursor: pointer;
    }

    .legal-link:not(:last-child) {
      border-bottom: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.05));
    }

    /* Стили для кнопки меню */
    .menu-button {
      width: 40px;
      height: 40px;
      border: 2px solid #ffffff;
      background-color: var(--tg-theme-button-color, #2481cc);
      border-radius: 8px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      gap: 4px;
      cursor: pointer;
      padding: 0;
      box-shadow: 0 2px 6px rgba(36, 129, 204, 0.25);
    }

    .menu-button span {
      display: block;
      width: 18px;
      height: 2px;
      background-color: var(--tg-theme-button-text-color, #ffffff);
      border-radius: 1px;
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 20px;
      z-index: 1000;
      overflow-y: auto;
    }

    .overlay.hidden {
      display: none;
    }

    .overlay-content {
      background: var(--tg-theme-bg-color, #ffffff);
      border-radius: 12px;
      width: 100%;
      max-width: 480px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .overlay-header {
      padding: 16px;
      border-bottom: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
    }

    .overlay-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .overlay-subtitle {
      font-size: 14px;
      color: var(--tg-theme-hint-color, #8e8e93);
    }

    .overlay-body {
      padding: 16px;
    }

    .menu-section {
      margin-bottom: 16px;
    }

    .menu-section.collapsed .menu-section-content {
      display: none;
    }

    .menu-section.collapsed .menu-section-arrow svg {
      transform: rotate(0deg);
    }

    .menu-section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      background: none;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      user-select: none;
    }

    .menu-section-header:hover {
      background: none;
      opacity: 0.8;
    }

    .menu-section-title {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .selected-count {
      font-size: 14px;
      color: var(--tg-theme-button-color, #2481cc);
    }

    .menu-section-arrow svg {
      width: 20px;
      height: 20px;
      transform: rotate(180deg);
      transition: transform 0.2s;
    }

    .menu-section-content {
      padding: 12px 0;
      background: none;
    }

    .menu-items {
      display: flex;
      flex-direction: column;
      gap: 8px;
      padding: 12px;
      background: none;
    }

    .menu-item {
      border: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      border-radius: 8px;
      padding: 10px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .menu-item.selected {
      border-color: var(--tg-theme-button-color, #2481cc);
      background: rgba(36, 129, 204, 0.05);
    }

    .menu-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .menu-item-info {
      flex: 1;
    }

    .menu-item-title {
      font-weight: 500;
      margin-bottom: 4px;
    }

    .menu-item-price {
      color: var(--tg-theme-hint-color, #8e8e93);
    }

    .volume-select {
      padding: 6px;
      border: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      border-radius: 6px;
      background: var(--tg-theme-bg-color, #ffffff);
      font-size: 14px;
      color: var(--tg-theme-text-color, #000000);
    }

    .form-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 20px;
      padding-top: 16px;
      border-top: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
    }

    .total-price {
      font-weight: 600;
      font-size: 16px;
    }

    .submit-button {
      background: var(--tg-theme-button-color, #2481cc);
      color: var(--tg-theme-button-text-color, #ffffff);
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
    }

    .submit-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .close-button-container {
      text-align: center;
      margin-top: 16px;
    }

    .close-button {
      background: none;
      border: none;
      color: var(--tg-theme-hint-color, #8e8e93);
      font-size: 14px;
      cursor: pointer;
      padding: 8px 16px;
    }

    .time-slider-container {
      margin-bottom: 20px;
    }

    .time-slider-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .time-slider-value {
      font-weight: 600;
      font-size: 16px;
    }

    .time-slider {
      width: 100%;
      height: 36px;
      background: var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      border-radius: 8px;
      -webkit-appearance: none;
      appearance: none;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .time-slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 28px;
      height: 28px;
      background: var(--tg-theme-button-color, #2481cc);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .time-slider::-moz-range-thumb {
      width: 28px;
      height: 28px;
      background: var(--tg-theme-button-color, #2481cc);
      border-radius: 50%;
      cursor: pointer;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    .time-marks {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
    }

    .time-mark {
      font-size: 14px;
      color: var(--tg-theme-hint-color, #8e8e93);
      cursor: pointer;
      transition: color 0.2s;
    }

    .time-mark:hover {
      color: var(--tg-theme-button-color, #2481cc);
    }

    /* Add new styles for category cards after the .preorder-content styles */
    .category-cards {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 16px;
      padding: 16px;
    }

    .category-card {
      background: var(--tg-theme-bg-color, #ffffff);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      position: relative;
    }

    .category-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }

    .category-card img {
      width: 100%;
      height: 100px;
      object-fit: cover;
    }

    .category-card-content {
      padding: 12px;
    }

    .category-card-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
      color: var(--tg-theme-text-color, #000000);
    }

    .category-card-description {
      font-size: 12px;
      color: var(--tg-theme-hint-color, #8e8e93);
    }

    .category-counter {
      position: absolute;
      bottom: 10px;
      right: 10px;
      background-color: #ff5722;
      color: white;
      min-width: 24px;
      height: 24px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 14px;
      z-index: 100;
      opacity: 0;
      transition: opacity 0.3s;
      padding: 0 8px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .category-counter.visible {
      opacity: 1;
    }

    /* Category header styles */
    .category-header {
      position: sticky;
      top: 0;
      background: var(--tg-theme-bg-color, #ffffff);
      z-index: 10;
      padding: 0 8px;
      margin: 0;
      border-bottom: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      display: flex;
      align-items: center;
      height: 32px;
      flex-shrink: 0;
    }

    .category-content {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 32px);
      overflow: hidden;
    }

    .back-to-categories {
      background: none;
      border: none;
      padding: 4px;
      margin: 0;
      cursor: pointer;
      color: var(--tg-theme-text-color, #000000);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .back-to-categories svg {
      width: 20px;
      height: 20px;
    }

    .category-title {
      margin: 0;
      font-size: 16px;
      line-height: 1.2;
      font-weight: 600;
      flex-grow: 1;
    }

    #drinksCategory .menu-items,
    #dessertsCategory .menu-items,
    #sandwichesCategory .menu-items,
    #icecreamCategory .menu-items,
    #colddrinksCategory .menu-items {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      padding: 12px;
      flex: 1 1 auto;
      min-height: 0;
      margin: 0;
    }

    /* Специальные стили для карточек десертов */
    #dessertsCategory .menu-item {
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    #dessertsCategory .menu-item-image {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 8px 8px 0 0;
      margin: -8px -8px 8px -8px;
      width: calc(100% + 16px);
    }

    #dessertsCategory .menu-item-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 0;
    }

    #dessertsCategory .menu-item-header {
      gap: 8px;
      align-items: flex-start;
    }

    #dessertsCategory .menu-item-title {
      font-size: 15px;
      line-height: 1.3;
      margin-bottom: 4px;
      font-weight: 500;
    }

    #dessertsCategory .menu-item-price {
      font-size: 15px;
      font-weight: 600;
      white-space: nowrap;
    }

    #dessertsCategory .menu-items {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      padding: 12px;
    }

    /* Стили для карточек напитков */
    #drinksCategory .menu-item {
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    #drinksCategory .menu-item-image {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 8px 8px 0 0;
      margin: -8px -8px 8px -8px;
      width: calc(100% + 16px);
    }

    #drinksCategory .menu-item-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 0;
    }

    #drinksCategory .menu-item-header {
      gap: 8px;
      align-items: flex-start;
    }

    #drinksCategory .menu-item-title {
      font-size: 15px;
      line-height: 1.3;
      margin-bottom: 4px;
      font-weight: 500;
    }

    #drinksCategory .menu-item-price {
      font-size: 15px;
      font-weight: 600;
      white-space: nowrap;
    }

    #drinksCategory .menu-items {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      padding: 12px;
    }

    .menu-item {
      border: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      border-radius: 12px;
      padding: 4px;
      display: flex;
      flex-direction: column;
      background: var(--tg-theme-bg-color, #ffffff);
      overflow: hidden;
      height: 100%;
    }

    .time-slider-container {
      padding: 8px;
      background: none;
      flex-shrink: 0;
      border-top: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
    }

    .category-items {
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
      position: relative;
      margin: 0;
      padding: 0;
    }

    .category-header {
      position: sticky;
      top: 0;
      left: 0;
      right: 0;
      height: 32px;
      padding: 0 8px;
      margin: 0;
      display: flex;
      align-items: center;
      background: var(--tg-theme-bg-color, #ffffff);
      border-bottom: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      flex-shrink: 0;
      z-index: 10;
    }

    .category-title {
      margin: 0;
      padding: 0;
      font-size: 16px;
      line-height: 1;
      font-weight: 600;
      flex-grow: 1;
    }

    .back-to-categories {
      background: none;
      border: none;
      padding: 0;
      margin: 0 4px 0 0;
      width: 24px;
      height: 24px;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
    }

    .back-to-categories svg {
      width: 20px;
      height: 20px;
    }

    #drinksCategory,
    #dessertsCategory,
    #sandwichesCategory,
    #icecreamCategory,
    #colddrinksCategory {
      margin: 0;
      padding: 0;
    }

    .menu-items {
      padding-top: 0;
      margin-top: 0;
    }

    .time-slider-wrapper {
      background: none;
      padding: 0;
      margin: 0;
    }

    .time-slider-label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 0 0 2px 0;
      font-size: 13px;
      color: var(--tg-theme-text-color, #000000);
    }

    .time-marks {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 2px 0 0 0;
      padding: 0 7px;
    }

    .menu-items {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
      gap: 16px;
      padding: 16px;
      margin-top: 0;
    }

    /* Ensure the menu items container has proper spacing */
    .category-items {
      position: relative;
      padding-top: 60px;
      height: calc(100% - 60px);
      overflow-y: auto;
    }

    /* Category view styles */
    .category-items {
      display: none;
      position: relative;
      padding-top: 60px;
      height: calc(100% - 60px);
      overflow-y: auto;
    }

    .category-items.active-view {
      display: block;
    }

    #categoryView {
      display: none;
    }

    #categoryView.active-view {
      display: block;
    }

    .category {
      position: relative;
      width: calc(50% - 10px);
      height: 150px;
      margin: 5px;
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.2s;
    }

    .category:hover {
      transform: scale(1.02);
    }

    /* Стили для карточек сэндвичей */
    #sandwichesCategory .menu-item {
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    #sandwichesCategory .menu-item-image {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 8px 8px 0 0;
      margin: -8px -8px 8px -8px;
      width: calc(100% + 16px);
    }

    #sandwichesCategory .menu-item-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 0;
    }

    #sandwichesCategory .menu-item-header {
      gap: 8px;
      align-items: flex-start;
    }

    #sandwichesCategory .menu-item-title {
      font-size: 15px;
      line-height: 1.3;
      margin-bottom: 4px;
      font-weight: 500;
    }

    #sandwichesCategory .menu-item-price {
      font-size: 15px;
      font-weight: 600;
      white-space: nowrap;
    }

    #sandwichesCategory .menu-items {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      padding: 12px;
    }

    /* Стили для карточек мороженого */
    #icecreamCategory .menu-item {
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    #icecreamCategory .menu-item-image {
      width: 100%;
      height: 160px;
      object-fit: cover;
      border-radius: 8px 8px 0 0;
      margin: -8px -8px 8px -8px;
      width: calc(100% + 16px);
    }

    #icecreamCategory .menu-item-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding: 0;
    }

    #icecreamCategory .menu-item-header {
      gap: 8px;
      align-items: flex-start;
    }

    /* Общие стили для всех категорий */
    #drinksCategory .menu-item-title,
    #dessertsCategory .menu-item-title,
    #sandwichesCategory .menu-item-title,
    #icecreamCategory .menu-item-title,
    #colddrinksCategory .menu-item-title {
      font-size: 13px;
      line-height: 1.2;
      margin-bottom: 4px;
      font-weight: 500;
    }

    #drinksCategory .menu-item-price,
    #dessertsCategory .menu-item-price,
    #sandwichesCategory .menu-item-price,
    #icecreamCategory .menu-item-price,
    #colddrinksCategory .menu-item-price {
      font-size: 14px;
      font-weight: 600;
      white-space: nowrap;
    }

    #drinksCategory .menu-item-header,
    #dessertsCategory .menu-item-header,
    #sandwichesCategory .menu-item-header,
    #icecreamCategory .menu-item-header,
    #colddrinksCategory .menu-item-header {
      gap: 6px;
    }

    #icecreamCategory .menu-items,
    #colddrinksCategory .menu-items {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      padding: 12px;
    }

    /* Добавляем новые стили для карточки */
    .menu-item[data-id="affogato"] {
        position: relative;
        overflow: hidden;
        border-radius: 16px;
        background: linear-gradient(145deg, rgba(255, 255, 255, 0.9), rgba(245, 245, 245, 0.8));
        backdrop-filter: blur(10px);
        box-shadow: 
            0 10px 20px rgba(0, 0, 0, 0.1),
            inset 0 0 0 1px rgba(255, 255, 255, 0.5);
        transition: all 0.3s ease;
        transform-style: preserve-3d;
        perspective: 1000px;
    }

    .menu-item[data-id="affogato"]:hover {
        transform: translateY(-5px) rotate3d(1, 1, 0, 5deg);
        box-shadow: 
            0 15px 30px rgba(0, 0, 0, 0.15),
            inset 0 0 0 1px rgba(255, 255, 255, 0.6),
            0 0 20px rgba(36, 129, 204, 0.2);
    }

    /* Пульсирующее свечение */
    .menu-item[data-id="affogato"]::before {
        content: '';
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
            circle,
            rgba(36, 129, 204, 0.1) 0%,
            transparent 70%
        );
        animation: pulse 4s infinite;
    }

    @keyframes pulse {
        0% { transform: scale(0.8); opacity: 0.5; }
        50% { transform: scale(1.2); opacity: 0.2; }
        100% { transform: scale(0.8); opacity: 0.5; }
    }

    /* Улучшенные частицы */
    .particle {
        position: absolute;
        background: radial-gradient(circle, rgba(255, 255, 255, 0.8) 0%, transparent 70%);
        border-radius: 50%;
        animation: floatImproved 4s infinite;
        filter: blur(1px);
    }

    .particle-1 { width: 6px; height: 6px; top: 20%; left: 20%; animation-delay: 0s; }
    .particle-2 { width: 8px; height: 8px; top: 40%; left: 60%; animation-delay: 1s; }
    .particle-3 { width: 5px; height: 5px; top: 60%; left: 30%; animation-delay: 2s; }
    .particle-4 { width: 7px; height: 7px; top: 80%; left: 70%; animation-delay: 3s; }
    .particle-5 { width: 4px; height: 4px; top: 30%; left: 80%; animation-delay: 2.5s; }
    .particle-6 { width: 6px; height: 6px; top: 70%; left: 40%; animation-delay: 1.5s; }

    @keyframes floatImproved {
        0% { 
            transform: translateY(0) translateX(0) rotate(0deg) scale(1); 
            opacity: 0; 
        }
        25% { 
            transform: translateY(-15px) translateX(5px) rotate(90deg) scale(1.2); 
            opacity: 0.8; 
        }
        50% { 
            transform: translateY(-25px) translateX(-5px) rotate(180deg) scale(1); 
            opacity: 1; 
        }
        75% { 
            transform: translateY(-35px) translateX(5px) rotate(270deg) scale(0.8); 
            opacity: 0.8; 
        }
        100% { 
            transform: translateY(-45px) translateX(0) rotate(360deg) scale(0.6); 
            opacity: 0; 
        }
    }

    /* Эффект кофейной ряби */
    .coffee-ripple {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 40%;
        background: 
            radial-gradient(
                circle at 50% 100%,
                rgba(101, 67, 33, 0.1) 0%,
                transparent 50%
            );
        animation: ripple 3s infinite;
        z-index: 1;
    }

    @keyframes ripple {
        0% { transform: scale(1); opacity: 0.3; }
        50% { transform: scale(1.1); opacity: 0.5; }
        100% { transform: scale(1); opacity: 0.3; }
    }

    /* Эффект горячести с улучшенным градиентом */
    .heat-effect {
        position: absolute;
        bottom: 0;
        left: 0;
        width: 100%;
        height: 40%;
        background: linear-gradient(
            to top,
            rgba(255, 124, 67, 0.15),
            rgba(255, 124, 67, 0.05) 50%,
            transparent
        );
        animation: heat 3s infinite;
        z-index: 1;
    }

    @keyframes heat {
        0% { opacity: 0.3; transform: translateY(0); }
        50% { opacity: 0.5; transform: translateY(-5px); }
        100% { opacity: 0.3; transform: translateY(0); }
    }

    /* Обновляем стили для контента */
    .menu-item[data-id="affogato"] .menu-item-header {
        position: relative;
        z-index: 5;
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 8px;
        padding: 12px;
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(5px);
        border-radius: 8px;
    }

    .menu-item[data-id="affogato"] .menu-item-price {
        font-weight: 600;
        color: #2481cc;
        text-shadow: 0 0 10px rgba(36, 129, 204, 0.3);
    }

    .support-button {
      background-color: var(--tg-theme-button-color, #2481cc);
      color: var(--tg-theme-button-text-color, #ffffff);
      padding: 12px 20px;
      border-radius: 8px;
      margin: 16px;
      text-align: center;
      cursor: pointer;
      font-weight: 500;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    .support-button svg {
      width: 20px;
      height: 20px;
    }

    .contact-options {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background-color: var(--tg-theme-bg-color, #ffffff);
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
      z-index: 10001;
      width: 90%;
      max-width: 320px;
      display: none;
    }

    .contact-options.visible {
      display: block;
    }

    .contact-title {
      font-size: 18px;
      font-weight: 600;
      margin-bottom: 20px;
      text-align: center;
      color: var(--tg-theme-text-color, #000000);
    }

    .contact-close {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 24px;
      height: 24px;
      border: none;
      background: none;
      font-size: 24px;
      line-height: 1;
      color: var(--tg-theme-hint-color, #999999);
      cursor: pointer;
      padding: 0;
    }

    .contact-option {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      margin-bottom: 8px;
      border-radius: 12px;
      cursor: pointer;
      color: var(--tg-theme-text-color, #000000);
      text-decoration: none;
      transition: background-color 0.2s;
    }

    .contact-option:last-child {
      margin-bottom: 0;
    }

    .contact-option:hover {
      background-color: var(--tg-theme-secondary-bg-color, rgba(0, 0, 0, 0.05));
    }

    .contact-option svg {
      width: 24px;
      height: 24px;
      flex-shrink: 0;
    }

    .contact-option.telegram svg {
      fill: #0088cc;
    }

    .contact-option.whatsapp svg {
      fill: #25D366;
    }

    .contact-option.email svg {
      fill: #EA4335;
    }

    .contact-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 10000;
      display: none;
    }

    .contact-overlay.visible {
      display: block;
    }

    .user-profile {
      padding: 16px;
      display: flex;
      align-items: center;
      border-bottom: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
    }

    .user-avatar {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      overflow: hidden;
      margin-right: 16px;
      background-color: var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .user-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .user-avatar svg {
      width: 36px;
      height: 36px;
    }

    .user-info {
      flex: 1;
    }

    .user-name {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .user-phone {
      font-size: 14px;
      color: var(--tg-theme-hint-color, #8e8e93);
      margin-bottom: 2px;
    }

    .user-id {
      font-size: 14px;
      color: var(--tg-theme-hint-color, #8e8e93);
    }

    #colddrinksCategory .menu-items {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
      padding: 12px;
    }

    #colddrinksCategory .category-header {
      margin-top: 0 !important;
      padding-top: 0 !important;
    }
    #colddrinksCategory .category-title {
      margin-top: 0 !important;
      padding-top: 0 !important;
    }
  </style>
</head>
<body>
  <div id="app">
    <div class="header">
      <button class="menu-button" id="menuButton" onclick="openSidebar()" aria-label="Меню">
        <span></span>
        <span></span>
        <span></span>
      </button>
      <div class="title" id="titleDropdownToggle">
        <span id="currentVenueType">Кофейни Кирова</span>
        <div class="title-dropdown" id="titleDropdown">
          <div class="dropdown-item active" data-type="coffee">Кофейни Кирова</div>
          <div class="dropdown-item" data-type="shawarma">Шаурмичные Кирова</div>
        </div>
      </div>
      <div class="search-container">
        <input type="text" id="searchInput" class="search-input" placeholder="Поиск..." />
        <button id="clearSearch" class="clear-search hidden">&times;</button>
      </div>
    </div>
    <div id="map">
      <div class="loading" id="loading">Загрузка карты...</div>
      <div class="error hidden" id="error"></div>
      <button class="nearest hidden" id="nearest" title="Найти ближайшую кофейню">
        <svg viewBox="0 0 24 24">
          <path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3A8.994 8.994 0 0 0 13 3.06V1h-2v2.06A8.994 8.994 0 0 0 3.06 11H1v2h2.06A8.994 8.994 0 0 0 11 20.94V23h2v-2.06A8.994 8.994 0 0 0 20.94 13H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/>
        </svg>
      </button>
      
      <div class="location-accuracy" id="locationAccuracy"></div>
      <div class="info-panel" id="infoPanel">
        <div class="info-title" id="infoTitle"></div>
        <div class="info-address" id="infoAddress"></div>
        <div class="info-hours" id="infoHours"></div>
        <div class="info-distance" id="infoDistance"></div>
        <button class="info-button" id="infoButton" onclick="openPreorderFormFromInfo()">
          <svg viewBox="0 0 24 24" width="16" height="16">
            <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z" fill="currentColor"/>
          </svg>
          Предзаказ
        </button>
      </div>
    </div>
  </div>
  
  <!-- Pre-order form (hidden by default) -->
  <div id="preorderOverlay" class="hidden">
    <div class="preorder-form">
      <div class="preorder-header">
        <div class="preorder-title-container">
          <div class="preorder-title" id="preorderTitle">Предзаказ кофе</div>
          <div class="preorder-subtitle" id="preorderSubtitle"></div>
        </div>
        <button id="closeButton" onclick="hideOverlay()">&times;</button>
      </div>
      <div class="preorder-content" id="preorderContent">
        <div id="categoryView" class="active-view">
          <div class="category-cards">
            <div class="category-card" onclick="showCategory('drinks')">
              <img src="https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?auto=format&fit=crop&w=400" alt="Напитки">
              <div class="category-card-content">
                <div class="category-card-title">Напитки</div>
                <div class="category-card-description">Кофе, чай и другие напитки</div>
              </div>
              <div class="category-counter" id="drinks-counter">0</div>
            </div>
            <div class="category-card" onclick="showCategory('desserts')">
              <img src="https://images.unsplash.com/photo-1488477181946-6428a0291777?auto=format&fit=crop&w=400" alt="Десерты">
              <div class="category-card-content">
                <div class="category-card-title">Десерты</div>
                <div class="category-card-description">Свежая выпечка и десерты</div>
              </div>
              <div class="category-counter" id="desserts-counter">0</div>
            </div>
            <div class="category-card" onclick="showCategory('sandwiches')">
              <img src="https://images.unsplash.com/photo-1528735602780-2552fd46c7af?auto=format&fit=crop&w=400" alt="Сэндвичи">
              <div class="category-card-content">
                <div class="category-card-title">Сэндвичи</div>
                <div class="category-card-description">Свежие и вкусные сэндвичи</div>
              </div>
              <div class="category-counter" id="sandwiches-counter">0</div>
            </div>
            <div class="category-card" onclick="showCategory('icecream')">
              <img src="https://images.unsplash.com/photo-1501443762994-82bd5dace89a?auto=format&fit=crop&w=400" alt="Мороженое">
              <div class="category-card-content">
                <div class="category-card-title">Мороженое</div>
                <div class="category-card-description">Классическое и особое мороженое</div>
              </div>
              <div class="category-counter" id="icecream-counter">0</div>
            </div>
          </div>
        </div>

        <!-- Category views -->
        <div id="drinksCategory" class="category-items">
          <div class="category-header">
            <button class="back-to-categories" onclick="showCategories()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6"/>
              </svg>
            </button>
            <h2 class="category-title">Напитки</h2>
          </div>
          <div class="menu-items">
            <div class="menu-item" data-id="americano" data-type="drink" data-price="150" onclick="selectMenuItem(this, 'drink')">
              <img src="https://images.unsplash.com/photo-1518832553480-cd0e625ed3e6?auto=format&fit=crop&w=300" alt="Американо" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Американо</div>
                  <div class="menu-item-price">150 ₽</div>
                </div>
              </div>
              <div class="menu-item-footer">
                <select class="volume-select" onchange="updateDrinkPrice('americano', this.value)" onclick="event.stopPropagation()">
                  <option value="small">200 мл</option>
                  <option value="medium" selected>300 мл</option>
                  <option value="large">400 мл</option>
                </select>
              </div>
            </div>
            <div class="menu-item" data-id="cappuccino" data-type="drink" data-price="180" onclick="selectMenuItem(this, 'drink')">
              <video autoplay loop muted playsinline class="menu-item-image" poster="https://images.unsplash.com/photo-1534778101976-62847782c213?auto=format&fit=crop&w=300">
                <source src="https://player.vimeo.com/external/368688126.sd.mp4?s=e89421b74f3f8b6d8b0e42c8c3a0d6b5c6e7f6c9&profile_id=164&oauth2_token_id=57447761" type="video/mp4">
              </video>
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Капучино</div>
                  <div class="menu-item-price">180 ₽</div>
                </div>
              </div>
              <div class="menu-item-footer">
                <select class="volume-select" onchange="updateDrinkPrice('cappuccino', this.value)" onclick="event.stopPropagation()">
                  <option value="small">200 мл</option>
                  <option value="medium" selected>300 мл</option>
                  <option value="large">400 мл</option>
                </select>
              </div>
            </div>
            <div class="menu-item" data-id="latte" data-type="drink" data-price="200" onclick="selectMenuItem(this, 'drink')">
              <img src="https://images.unsplash.com/photo-1570968915860-54d5c301fa9f?auto=format&fit=crop&w=300" alt="Латте" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Латте</div>
                  <div class="menu-item-price">200 ₽</div>
                </div>
              </div>
              <div class="menu-item-footer">
                <select class="volume-select" onchange="updateDrinkPrice('latte', this.value)" onclick="event.stopPropagation()">
                  <option value="small">200 мл</option>
                  <option value="medium" selected>300 мл</option>
                  <option value="large">400 мл</option>
                </select>
              </div>
            </div>
            <div class="menu-item" data-id="espresso" data-type="drink" data-price="120" onclick="selectMenuItem(this, 'drink')">
              <img src="https://images.unsplash.com/photo-1510591509098-f4fdc6d0ff04?auto=format&fit=crop&w=300" alt="Эспрессо" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Эспрессо</div>
                  <div class="menu-item-price">120 ₽</div>
                </div>
              </div>
              <div class="menu-item-footer">
                <select class="volume-select" onchange="updateDrinkPrice('espresso', this.value)" onclick="event.stopPropagation()">
                  <option value="small">30 мл</option>
                  <option value="medium" selected>60 мл</option>
                  <option value="large">90 мл</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div id="dessertsCategory" class="category-items">
          <div class="category-header">
            <button class="back-to-categories" onclick="showCategories()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6"/>
              </svg>
            </button>
            <h2 class="category-title">Десерты</h2>
          </div>
          <div class="menu-items">
            <div class="menu-item" data-id="cheesecake" data-type="dessert" data-price="250" onclick="selectMenuItem(this, 'dessert')">
              <img src="https://images.unsplash.com/photo-1567171466295-4afa63d45416?auto=format&fit=crop&w=300" alt="Чизкейк" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Чизкейк Нью-Йорк</div>
                  <div class="menu-item-price">250 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="tiramisu" data-type="dessert" data-price="280" onclick="selectMenuItem(this, 'dessert')">
              <img src="https://images.unsplash.com/photo-1571877227200-a0d98ea607e9?auto=format&fit=crop&w=300" alt="Тирамису" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Тирамису</div>
                  <div class="menu-item-price">280 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="brownie" data-type="dessert" data-price="220" onclick="selectMenuItem(this, 'dessert')">
              <img src="https://images.unsplash.com/photo-1564355808539-22fda35bed7e?auto=format&fit=crop&w=300" alt="Брауни" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Брауни</div>
                  <div class="menu-item-price">220 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="eclair" data-type="dessert" data-price="180" onclick="selectMenuItem(this, 'dessert')">
              <img src="https://images.unsplash.com/photo-1558326567-98ae2405596b?auto=format&fit=crop&w=300" alt="Эклер" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Эклер</div>
                  <div class="menu-item-price">180 ₽</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="sandwichesCategory" class="category-items">
          <div class="category-header">
            <button class="back-to-categories" onclick="showCategories()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6"/>
              </svg>
            </button>
            <h2 class="category-title">Сэндвичи</h2>
          </div>
          <div class="menu-items">
            <div class="menu-item" data-id="club" data-type="sandwich" data-price="320" onclick="selectMenuItem(this, 'sandwich')">
              <img src="https://images.unsplash.com/photo-1528735602780-2552fd46c7af?auto=format&fit=crop&w=300" alt="Клаб-сэндвич" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Клаб-сэндвич</div>
                  <div class="menu-item-price">320 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="chicken" data-type="sandwich" data-price="280" onclick="selectMenuItem(this, 'sandwich')">
              <img src="https://images.unsplash.com/photo-1521390188846-e2a3a97453a0?auto=format&fit=crop&w=300" alt="Сэндвич с курицей" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Сэндвич с курицей</div>
                  <div class="menu-item-price">280 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="tuna" data-type="sandwich" data-price="290" onclick="selectMenuItem(this, 'sandwich')">
              <img src="https://images.unsplash.com/photo-1485451456034-3f9391c6f769?auto=format&fit=crop&w=300" alt="Сэндвич с тунцом" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Сэндвич с тунцом</div>
                  <div class="menu-item-price">290 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="veggie" data-type="sandwich" data-price="250" onclick="selectMenuItem(this, 'sandwich')">
              <img src="https://images.unsplash.com/photo-1540713434306-58505cf1b6fc?auto=format&fit=crop&w=300" alt="Вегетариан" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Вегетариан сэндвич</div>
                  <div class="menu-item-price">250 ₽</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="icecreamCategory" class="category-items">
          <div class="category-header">
            <button class="back-to-categories" onclick="showCategories()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6"/>
              </svg>
            </button>
            <h2 class="category-title">Мороженое</h2>
          </div>
          <div class="menu-items">
            <div class="menu-item" data-id="vanilla" data-type="icecream" data-price="150" onclick="selectMenuItem(this, 'icecream')">
              <img src="https://images.unsplash.com/photo-1570197788417-0e82375c9371?auto=format&fit=crop&w=300" alt="Ванильное" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Ванильное мороженое</div>
                  <div class="menu-item-price">150 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="chocolate" data-type="icecream" data-price="150" onclick="selectMenuItem(this, 'icecream')">
              <img src="https://images.unsplash.com/photo-1563805042-7684c019e1cb?auto=format&fit=crop&w=300" alt="Шоколадное" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Шоколадное мороженое</div>
                  <div class="menu-item-price">150 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="sundae" data-type="icecream" data-price="280" onclick="selectMenuItem(this, 'icecream')">
              <img src="https://images.unsplash.com/photo-1563805042-7684c019e1cb?auto=format&fit=crop&w=300" alt="Сандей" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Сандей с топпингами</div>
                  <div class="menu-item-price">280 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="affogato" data-type="icecream" data-price="220" onclick="selectMenuItem(this, 'icecream')">
              <div class="particles">
                <div class="particle particle-1"></div>
                <div class="particle particle-2"></div>
                <div class="particle particle-3"></div>
                <div class="particle particle-4"></div>
                <div class="particle particle-5"></div>
                <div class="particle particle-6"></div>
              </div>
              <div class="coffee-ripple"></div>
              <div class="heat-effect"></div>
              <img src="https://images.unsplash.com/photo-1579954115545-a95591f28bfc?auto=format&fit=crop&w=300" alt="Аффогато" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Аффогато</div>
                  <div class="menu-item-price">220 ₽</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="colddrinksCategory" class="category-items">
          <div class="category-header">
            <button class="back-to-categories" onclick="showCategories()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6"/>
              </svg>
            </button>
            <h2 class="category-title">Холодные напитки</h2>
          </div>
          <div class="menu-items">
            <div class="menu-item" data-id="icecoffee" data-type="colddrink" data-price="280" onclick="selectMenuItem(this, 'colddrink')">
              <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=300" alt="Айс-Кофе" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Айс-Кофе</div>
                  <div class="menu-item-price">280 ₽</div>
                </div>
              </div>
              <div class="menu-item-footer">350 мл</div>
            </div>
            <div class="menu-item" data-id="bumble" data-type="colddrink" data-price="330" onclick="selectMenuItem(this, 'colddrink')">
              <img src="https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=300" alt="Бамбл" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Бамбл</div>
                  <div class="menu-item-price">330 ₽</div>
                </div>
              </div>
              <div class="menu-item-footer">450 мл</div>
            </div>
            <div class="menu-item" data-id="milkshake" data-type="colddrink" data-price="280" onclick="selectMenuItem(this, 'colddrink')">
              <img src="https://images.unsplash.com/photo-1519864600265-abb23847ef2c?auto=format&fit=crop&w=300" alt="Молочный коктейль" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Молочный коктейль</div>
                  <div class="menu-item-price">280 ₽</div>
                </div>
              </div>
              <div class="menu-item-footer">350 мл</div>
            </div>
            <div class="menu-item" data-id="coffeemilkshake" data-type="colddrink" data-price="290" onclick="selectMenuItem(this, 'colddrink')">
              <img src="https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=300" alt="Кофейный милкшейк" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Кофейный милкшейк</div>
                  <div class="menu-item-price">290 ₽</div>
                </div>
              </div>
              <div class="menu-item-footer">350 мл</div>
            </div>
          </div>
        </div>

        <div class="time-slider-container">
          ${generateTimeSlider()}
        </div>

        <div class="form-group">
          <label class="form-label" for="comment">Комментарий к заказу</label>
          <input type="text" class="form-input" id="comment" placeholder="Например: без сахара">
        </div>

        <div class="form-footer">
          <div class="total-price" id="totalPrice">Итого: 0 ₽</div>
          <button class="submit-button" id="submitOrder" onclick="submitOrder()" disabled>Заказать</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Sidebar overlay -->
  <div id="sidebarOverlay" class="sidebar-overlay" onclick="closeSidebar()"></div>

  <!-- Sidebar -->
  <div id="sidebar" class="sidebar">
    <div class="sidebar-header">
      <button class="sidebar-back" id="sidebarBack" onclick="showMainMenu()">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M15 18l-6-6 6-6"/>
        </svg>
      </button>
      <div class="sidebar-title" id="sidebarTitle">Кофейни Кирова</div>
      <button class="sidebar-close" onclick="closeSidebar()">&times;</button>
    </div>
    
    <div id="sidebarContent">
      <!-- Содержимое будет загружено динамически -->
    </div>
  </div>
  
  <script>
    // Initialize Telegram Mini App
    let tg = window.Telegram?.WebApp;
    if (tg) {
      tg.expand();
      tg.ready();
    }
    
    // Cafe data
    const cafes = [
  {
    name: "Simply Coffee",
    address: "ул. Карла Маркса, 127/3, Киров",
    coords: [58.591360, 49.668697],
    hours: "Ежедневно 08:00–21:00"
  },
  {
    name: "Лампа Грина",
    address: "ул. Московская, 3, Киров",
    coords: [58.604035, 49.683965],
    hours: "Ежедневно 07:00–22:00"
  },
  {
    name: "Bomarshe",
    address: "ул. Преображенская, 29, Киров",
    coords: [58.605530, 49.675189],
    hours: "Ежедневно 08:00–21:00"
  },
  {
    name: "Лампа Грина",
    address: "пр. Ленина, 54, Киров",
    coords: [58.609031, 49.680772],
    hours: "Ежедневно 07:00–21:00"
  },
  {
    name: "Лампа Грина",
    address: "пр. Октябрьский, 139, Киров",
    coords: [58.593329, 49.657418],
    hours: "Ежедневно 07:00–21:00"
  },
  {
    name: "Зерно",
    address: "ул. Карла Маркса, 80, Киров",
    coords: [58.600682, 49.668539],
    hours: "Ежедневно 08:00–20:00"
  },
  {
    name: "Gussi Coffee",
    address: "ул. Дмитрия Козулева, 2, Киров",
    coords: [58.579781, 49.559036],
    hours: "Ежедневно 08:00–20:00"
  },
  {
    name: "Шоколадница",
    address: "ул. Спасская, 18а, Киров",
    coords: [58.601850, 49.674333],
    hours: "Ежедневно 09:00–21:00"
  },
  {
    name: "Чизкеечная",
    address: "ул. Розы Люксембург, 17а, Киров",
    coords: [58.612096, 49.679020],
    hours: "Ежедневно 10:00–21:00"
  },
  {
    name: "Coffee Like",
    address: "пр. Октябрьский, 117, Киров",
    coords: [58.604365, 49.656841],
    hours: "Ежедневно 07:45–21:00"
  },
  {
    name: "Printer Coffee",
    address: "ул. Карла Либкнехта, 74, Киров",
    coords: [58.604908, 49.665294],
    hours: "Ежедневно 09:00–21:00"
  },
  {
    name: "Чизкеечная",
    address: "ул. Воровского, 55, Киров",
    coords: [58.594052, 49.665083],
    hours: "Ежедневно 10:00–21:00"
  },
  {
    name: "Хачапури Мадлiani",
    address: "ул. Карла Маркса, 63, Киров",
    coords: [58.604925, 49.666349],
    hours: "Ежедневно 10:00–21:00"
  },
  {
    name: "Больше, чем торт",
    address: "ул. Московская, 17, Киров",
    coords: [58.604249, 49.676947],
    hours: "Ежедневно 09:00–20:00"
  },
  {
    name: "Малевич",
    address: "ул. Московская, 12, Киров",
    coords: [58.603325, 49.677010],
    hours: "Ежедневно 09:00–21:00"
  },
  {
    name: "Нина",
    address: "ул. МОПРа, 26г, Киров",
    coords: [58.610088, 49.682042],
    hours: "Ежедневно 08:00–19:00"
  },
  {
    name: "Coffee Like",
    address: "ул. Спасская, 6, Киров",
    coords: [58.602078, 49.681554],
    hours: "Ежедневно 08:00–22:00"
  },
  {
    name: "Малевич",
    address: "ул. Воровского, 43, Киров",
    coords: [58.594201, 49.665903],
    hours: "Ежедневно 10:00–21:00"
  },
  {
    name: "Фракция",
    address: "ул. Ленина, 86, Киров",
    coords: [58.601632, 49.681431],
    hours: "Ежедневно 08:00–22:00"
  },
  {
    name: "Малевич",
    address: "ул. Луганская, 53/2, Киров",
    coords: [58.617044, 49.595800],
    hours: "Ежедневно 10:00–21:00"
  },
  {
    name: "Кофе & Книги",
    address: "ул. Герцена, 50, Киров",
    coords: [58.599696, 49.659832],
    hours: "Ежедневно 10:00–19:00"
  },
  {
    name: "Люди Говорят",
    address: "ул. Дерендяева, 25, Киров",
    coords: [58.588995, 49.659222],
    hours: "Ежедневно 10:00–19:00"
  },
  {
    name: "Ё кофе",
    address: "ул. Преображенская, 95, Киров",
    coords: [58.605234, 49.654056],
    hours: "Ежедневно 09:00–22:00"
  },
  {
    name: "КофеЛюб",
    address: "пр. Октябрьский, 143, Киров",
    coords: [58.592255, 49.657320],
    hours: "Выходной"
  },
  {
    name: "Люди Говорят",
    address: "пр. Октябрьский, 104, Киров",
    coords: [58.588995, 49.659222],
    hours: "Ежедневно 08:30–19:30"
  },
  {
    name: "Cuprum",
    address: "ул. Московская, 15, Киров",
    coords: [58.603915, 49.678552],
    hours: "Ежедневно 09:00–20:00"
  },
  {
    name: "Baron Chaikha",
    address: "ул. Розы Люксембург, 30, Киров",
    coords: [58.611725, 49.678839],
    hours: "Ежедневно 09:00–21:00"
  },
  {
    name: "Coffee Like",
    address: "ул. Московская, 7, Киров",
    coords: [58.603891, 49.680352],
    hours: "Ежедневно 07:30–21:00"
  },
  {
    name: "New-York Coffee",
    address: "ул. Карла Либкнехта, 71, Киров",
    coords: [58.602872, 49.664424],
    hours: "Ежедневно 09:00–21:00"
  },
  {
    name: "Люди Говорят",
    address: "ул. Карла Маркса, 132, Киров",
    coords: [58.589117, 49.669884],
    hours: "Ежедневно 09:00–21:00"
  },
  {
    name: "Эклерия",
    address: "ул. Московская, 33а, Киров",
    coords: [58.603718, 49.670658],
    hours: "Ежедневно 09:00–21:00"
  },
  {
    name: "Coffee Like",
    address: "ул. Краснополянская, 3, Киров",
    coords: [58.601736, 49.576512],
    hours: "Ежедневно 07:30–20:30"
  },
  {
    name: "Varim",
    address: "ул. Калинина, 9, Киров",
    coords: [58.587781, 49.640959],
    hours: "Ежедневно 09:00–21:00"
  },
  {
    name: "Тартин",
    address: "ул. Орловская, 15, Киров",
    coords: [58.596409, 49.685252],
    hours: "Ежедневно 11:00–19:00"
  },
  {
    name: "Полезнямки",
    address: "ул. Герцена, 64, Киров",
    coords: [58.599696, 49.659832],
    hours: "Ежедневно 10:00–19:00"
  },
  {
    name: "RJ Coffee",
    address: "ул. Капитана Дорофеева, 26, Киров",
    coords: [58.580658, 49.563199],
    hours: "Ежедневно 09:00–21:00"
  },
  {
    name: "Redbrick Coffee",
    address: "ул. Спасская, 38, Киров",
    coords: [58.601725, 49.665574],
    hours: "Ежедневно 08:00–21:00"
  },
  {
    name: "Бодрящий поцелуй",
    address: "ул. Воровского, 43, Киров",
    coords: [58.594605, 49.667109],
    hours: "Ежедневно 08:00–20:00"
  },
  {
    name: "Меренга Мания",
    address: "ул. Дмитрия Козулева, 2, Киров",
    coords: [58.580089, 49.558787],
    hours: "Ежедневно 09:00–19:00"
  },
  {
    name: "Панда Чё",
    address: "ул. Воровского, 50в, Киров",
    coords: [58.593234, 49.654333],
    hours: "Ежедневно 08:20–24:00"
  },
  {
    name: "Арт-кофейня",
    address: "ул. Горького, 5а, Киров",
    coords: [58.599047, 49.648663],
    hours: "Ежедневно 10:00–22:00"
  },
  {
    name: "Десертомания",
    address: "ул. Карла Маркса, 18а, Киров",
    coords: [58.613851, 49.667326],
    hours: "Ежедневно 10:00–19:00"
  },
  {
    name: "Bar",
    address: "ул. Воровского, 135, Киров",
    coords: [58.598195, 49.606836],
    hours: "Ежедневно 10:00–21:00"
  },
  {
    name: "Ё кофе",
    address: "ул. Московская, 133, Киров",
    coords: [58.603332, 49.622093],
    hours: "Ежедневно 09:00–20:00"
  },
  {
    name: "Кофейные моменты",
    address: "ул. Василия Жуковского, 11а, Киров",
    coords: [58.641668, 49.607986],
    hours: "Ежедневно 10:00–20:00"
  }
];

    // Shawarma data
    const shawarma = [
      {name: "Киоск шаурмы", address: "Площадь Александра Невского, улица Ленина, 102Б/1, Киров", coords: [58.594133, 49.684390], hours: "Ежедневно 10:00–22:00"},
      {name: "Киоск по продаже шаурмы", address: "Студенческий проезд, 28/3, Киров", coords: [58.596422, 49.618848], hours: "Ежедневно 08:00–22:00"},
      {name: "Lavash", address: "Улица Ленина, 107, Киров", coords: [58.592904, 49.681399], hours: "Ежедневно 10:00–21:00"},
      {name: "Lavash", address: "Улица Воровского, 48/1, Киров", coords: [58.578006, 49.605329], hours: "Ежедневно 10:00–22:00"},
      {name: "Ещё вкуснее", address: "Привокзальная площадь, 1/1, Киров", coords: [58.595000, 49.673000], hours: "Ежедневно 07:00–20:00"},
      {name: "Вятич Спорт", address: "Уральская улица, 14, Киров", coords: [58.632740, 49.626018], hours: "Ежедневно 11:00–24:00"},
      {name: "Мельница", address: "Улица Воровского, 7, Киров", coords: [58.594245, 49.680563], hours: "Ежедневно 07:30–20:00"},
      {name: "Тот самый бар", address: "Улица Труда, 87, Киров", coords: [58.608340, 49.652347], hours: "Ежедневно 11:00–24:00"},
      {name: "Корона", address: "Центральный рынок, Пролетарская улица, 24а/1, Киров", coords: [58.589283, 49.675398], hours: "Круглосуточно"},
      {name: "Shau", address: "Преображенская улица, 25, Киров", coords: [58.605569, 49.676350], hours: "Ежедневно 10:00–22:00"},
      {name: "Durum", address: "ЭкоЯрмарка, улица Щорса, 79, Киров", coords: [58.578006, 49.605329], hours: "Ежедневно 09:00–20:00"},
      {name: "Marshall Grill", address: "Улица Ленина, 18, Киров", coords: [58.612357, 49.680842], hours: "Ежедневно 10:00–22:00"},
      {name: "Marshall Grill", address: "Улица Свободы, 135Б/1, Киров", coords: [58.588936, 49.677500], hours: "Ежедневно 10:00–24:00"},
      {name: "ШаурмаClub", address: "Улица Риммы Юровской, 11/1, Киров", coords: [58.587618, 49.592690], hours: "Ежедневно 10:00–21:00"}
    ];
    
    // Variables
    let map;
    let userLocation = null;
    let coffeeShops = [];
    let userPlacemark = null;
    let userLocationCircle = null;
    let currentRoute = null;
    let currentNearestShop = null;
    let currentVenueType = 'coffee'; // 'coffee' или 'shawarma'
    
    // Variables for order
    let currentShop = null;
    let selectedDrink = null;
    let selectedDessert = null;
    let selectedSandwich = null;
    let selectedIcecream = null;
    let selectedExtras = [];
    let totalPrice = 0;

    // Drink prices for different volumes
    const drinkPrices = {
      americano: { small: 130, medium: 150, large: 180 },
      cappuccino: { small: 160, medium: 180, large: 210 },
      latte: { small: 180, medium: 200, large: 230 },
      espresso: { small: 90, medium: 120, large: 150 }
    };

    // Update drink price based on selected volume
    function updateDrinkPrice(drinkId, volume) {
      const drinkElement = document.querySelector(`[data-id="${drinkId}"]`);
      const priceElement = drinkElement.querySelector('.menu-item-price');
      const price = drinkPrices[drinkId][volume];
      priceElement.textContent = `${price} ₽`;
      
      // Update the data-price attribute
      drinkElement.dataset.price = price;
      
      // Automatically select the drink if it's not already selected
      if (!drinkElement.classList.contains('selected')) {
        // For special drinks (americano, cappuccino, latte, espresso)
        if (['americano', 'cappuccino', 'latte', 'espresso'].includes(drinkId)) {
          drinkElement.classList.add('selected');
          updateCategoryCounters();
          updateSubmitButton();
        } else {
          // For regular drinks, use the existing selection logic
          const itemTitle = drinkElement.querySelector('.menu-item-title').textContent;
          const selectedItem = {
            id: drinkId,
            name: itemTitle,
            price: price
          };
          
          // Remove selection from other drinks
          document.querySelectorAll('.menu-item[data-type="drink"]').forEach(item => {
            if (item !== drinkElement) {
              item.classList.remove('selected');
            }
          });
          
          drinkElement.classList.add('selected');
          selectedDrink = selectedItem;
        }
      }
      
      // Update total price
      updateTotalPrice();
    }

    // User data
    let userData = {
      name: "Пользователь",
      phone: "",
      id: "",
      avatar: "", // Remove default placeholder
      balance: 350,
      orders: [],
      referral: {
        code: "",
        invited: 0,
        bonusEarned: 0
      }
    };
    
    // Show error
    function showError(message, duration = 5000) {
      const errorEl = document.getElementById('error');
      errorEl.textContent = message;
      errorEl.classList.remove('hidden');
      
      setTimeout(() => {
        errorEl.classList.add('hidden');
      }, duration);
    }

    // Show success notification
    function showSuccess(message, duration = 3000) {
      const successEl = document.createElement('div');
      successEl.className = 'success';
      successEl.textContent = message;
      document.getElementById('map').appendChild(successEl);
      
      setTimeout(() => {
        successEl.remove();
      }, duration);
    }
    
    // Проверяем, загружен ли API Яндекс Карт
    function checkYmapsLoaded() {
      return typeof ymaps !== 'undefined';
    }

    // Инициализация приложения
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM loaded');
      
      // Сначала инициализируем цены напитков
      initializeDrinkPrices();
      
      // Затем настраиваем UI
      setupUI();
      
      // Проверяем, загружен ли API Яндекс Карт
      if (checkYmapsLoaded()) {
        console.log('Yandex Maps API is loaded');
        // Инициализируем карту, когда API готов
        ymaps.ready(initMap);
      } else {
        console.error('Yandex Maps API is not loaded');
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('error').textContent = 'Ошибка при загрузке API Яндекс Карт. Проверьте подключение к интернету и попробуйте перезагрузить страницу.';
        document.getElementById('error').classList.remove('hidden');
      }
    });

    // Setup UI
    function setupUI() {
      // Setup sidebar
      setupSidebar();
      
      // Setup dropdown menu
      setupDropdownMenu();
      
      // Setup search functionality
      setupSearch();
      
      // Get user data from Telegram
      getUserDataFromTelegram();
    }
    
    // Инициализация карты
    function initMap() {
      try {
        console.log('Initializing map...');
        
        // Показываем индикатор загрузки
        document.getElementById('loading').textContent = 'Загрузка карты...';
        document.getElementById('loading').classList.remove('hidden');
        
        // Создаем карту с минимальными настройками
        map = new ymaps.Map('map', {
          center: [58.603, 49.668], // Центр Кирова
          zoom: 13,
          controls: []
        });
        
        console.log('Map created');
        
        // Добавляем элементы управления после создания карты
        map.controls.add('zoomControl');
        
        // Загружаем заведения
        loadVenues();
        
        // Получаем местоположение пользователя
        getUserLocation().then(() => {
          // Показываем кнопку поиска ближайшего заведения
          if (userLocation) {
            const nearestBtn = document.getElementById('nearest');
            nearestBtn.classList.remove('hidden');
            nearestBtn.onclick = findNearestAndZoomToUser;
          }
        }).catch(error => {
          console.error('Geolocation error:', error);
          showError('Не удалось определить ваше местоположение. Проверьте настройки доступа к геолокации.');
        }).finally(() => {
          // Скрываем индикатор загрузки
          document.getElementById('loading').classList.add('hidden');
        });
      } catch (error) {
        console.error('Map initialization error:', error);
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('error').textContent = 'Ошибка при инициализации карты. Попробуйте перезагрузить страницу.';
        document.getElementById('error').classList.remove('hidden');
      }
    }
    
    // Get user location with high accuracy
    async function getUserLocation() {
      try {
        // Показываем индикатор загрузки
        document.getElementById('loading').textContent = 'Определение местоположения...';
        document.getElementById('loading').classList.remove('hidden');
        
        // Используем браузерный API геолокации вместо Яндекс.Карт
        return new Promise((resolve, reject) => {
          if (!navigator.geolocation) {
            reject(new Error('Геолокация не поддерживается вашим браузером'));
            return;
          }
          
          navigator.geolocation.getCurrentPosition(
            (position) => {
              // Получаем координаты
              userLocation = [position.coords.latitude, position.coords.longitude];
              console.log('User location:', userLocation);
              
              // Добавляем маркер пользователя
              if (map) {
                // Удаляем существующий маркер пользователя, если он есть
                if (userPlacemark) {
                  map.geoObjects.remove(userPlacemark);
                }
                
                // Добавляем маркер пользователя
                userPlacemark = new ymaps.Placemark(userLocation, {
                  hintContent: 'Вы здесь'
                }, {
                  preset: 'islands#geolocationIcon',
                  iconColor: '#1e98ff'
                });
                
                map.geoObjects.add(userPlacemark);
                
                // Центрируем карту
                map.setCenter(userLocation, 16);
              }
              
              // Скрываем индикатор загрузки
              document.getElementById('loading').classList.add('hidden');
              
              resolve(userLocation);
            },
            (error) => {
              console.error('Geolocation error:', error);
              let errorMessage = 'Не удалось определить ваше местоположение.';
              
              switch (error.code) {
                case error.PERMISSION_DENIED:
                  errorMessage += ' Вы отклонили запрос на геолокацию.';
                  break;
                case error.POSITION_UNAVAILABLE:
                  errorMessage += ' Информация о местоположении недоступна.';
                  break;
                case error.TIMEOUT:
                  errorMessage += ' Истекло время ожидания запроса на геолокацию.';
                  break;
                case error.UNKNOWN_ERROR:
                  errorMessage += ' Произошла неизвестная ошибка.';
                  break;
              }
              
              document.getElementById('loading').classList.add('hidden');
              showError(errorMessage);
              reject(error);
            },
            {
              enableHighAccuracy: true,
              timeout: 10000,
              maximumAge: 0
            }
          );
        });
      } catch (error) {
        console.error('Geolocation error:', error);
        document.getElementById('loading').classList.add('hidden');
        showError('Не удалось определить ваше местоположение. Проверьте настройки доступа к геолокации.');
        throw error;
      }
    }

    // Обновление маршрута до заведения при изменении местоположения пользователя
    function updateRouteToShop(shop) {
      // Проверяем, доступно ли местоположение пользователя
      if (!userLocation) {
        return;
      }
      
      // Удаляем существующий маршрут
      if (currentRoute) {
        map.geoObjects.remove(currentRoute);
        currentRoute = null;
      }
      
      // Создаем новый маршрут
      const multiRoute = new ymaps.multiRouter.MultiRoute({
        referencePoints: [
          userLocation,
          shop.coords
        ],
        params: {
          routingMode: 'pedestrian',
          avoidTrafficJams: false
        }
      }, {
        boundsAutoApply: false,
        wayPointVisible: false,
        routeActiveStrokeColor: "#795548",
        routeActiveStrokeWidth: 4
      });
      
      // Добавляем маршрут на карту
      map.geoObjects.add(multiRoute);
      currentRoute = multiRoute;
      
      // Пересчитываем расстояние
      const distance = ymaps.coordSystem.geo.getDistance(userLocation, shop.coords);
      shop.distance = distance;
      
      // Обновляем информацию о расстоянии в инфо-панели, если она открыта
      const infoPanel = document.getElementById('infoPanel');
      if (infoPanel.classList.contains('visible')) {
        document.getElementById('infoDistance').textContent = `Расстояние: ${formatDistance(distance)}`;
      }
    }
    
    // Format distance
    function formatDistance(distance) {
      if (distance < 1000) {
        return `${Math.round(distance)} м`;
      } else {
        return `${(distance / 1000).toFixed(1)} км`;
      }
    }
    
    // Load venues based on current type
    function loadVenues() {
      try {
        // Проверяем, что карта инициализирована
        if (!map || !map.geoObjects) {
          console.error('Map is not initialized');
          return;
        }
        
        // Удаляем все метки, кроме маркера пользователя
        const objects = [];
        map.geoObjects.each(function(obj) {
          if (obj !== userPlacemark) {
            objects.push(obj);
          }
        });
        objects.forEach(function(obj) {
          map.geoObjects.remove(obj);
        });
        
        // Выбираем данные в зависимости от типа заведения
        const venuesData = currentVenueType === 'coffee' ? cafes : shawarma;
        
        // Загружаем заведения
        coffeeShops = venuesData.map(venue => {
          try {
            // Create placemark
            const placemark = new ymaps.Placemark(venue.coords, {
              hintContent: venue.name,
              iconContent: currentVenueType === 'coffee' ? '☕' : ''
            }, {
              preset: currentVenueType === 'coffee' ? 'islands#blueIcon' : 'islands#orangeFoodIcon'
            });
            
            // Store venue data directly in placemark
            placemark.venueData = {
              name: venue.name,
              address: venue.address,
              hours: venue.hours,
              coords: venue.coords
            };
            
            // Add click event to placemark
            placemark.events.add('click', function() {
              // Calculate distance if user location is available
              let distance = null;
              if (userLocation) {
                distance = ymaps.coordSystem.geo.getDistance(userLocation, venue.coords);
                
                // Build route to this venue
                showRouteToShop({
                  name: venue.name,
                  address: venue.address,
                  hours: venue.hours,
                  coords: venue.coords,
                  distance: distance
                });
              }
              
              // Create balloon content with distance
              const balloonContent = createBalloonContent(venue.name, venue.address, venue.hours, distance);
              
              // Store current shop for pre-order
              currentShop = {
                name: venue.name,
                address: venue.address,
                hours: venue.hours,
                coords: venue.coords
              };
              
              // Force close any open balloon first
              map.balloon.close();
              
              // Then open a new balloon at the placemark's position
              map.balloon.open(venue.coords, {
                content: balloonContent
              }, {
                closeButton: true
              });
            });
            
            map.geoObjects.add(placemark);
            
            return {
              name: venue.name,
              address: venue.address,
              coords: venue.coords,
              hours: venue.hours,
              placemark
            };
          } catch (error) {
            console.error('Error creating placemark:', error);
            return null;
          }
        }).filter(shop => shop !== null); // Фильтруем null значения
      } catch (error) {
        console.error('Error loading venues:', error);
        showError('Ошибка при загрузке заведений. Попробуйте перезагрузить страницу.');
      }
    }

    // Search functionality
    function setupSearch() {
      const searchInput = document.getElementById('searchInput');
      const clearButton = document.getElementById('clearSearch');
      
      // Add event listeners
      searchInput.addEventListener('input', handleSearch);
      clearButton.addEventListener('click', clearSearch);
      
      function handleSearch() {
        const searchTerm = searchInput.value.trim().toLowerCase();
        
        if (searchTerm.length > 0) {
          // Show clear button
          clearButton.classList.remove('hidden');
          
          // Filter venues
          const filteredShops = coffeeShops.filter(shop => {
            return shop.name.toLowerCase().includes(searchTerm) || 
                   shop.address.toLowerCase().includes(searchTerm);
          });
          
          // Hide all placemarks first
          coffeeShops.forEach(shop => {
            shop.placemark.options.set('visible', false);
          });
          
          // Show matching placemarks and add highlight
          filteredShops.forEach(shop => {
            shop.placemark.options.set('visible', true);
            shop.placemark.options.set('preset', currentVenueType === 'coffee' ? 'islands#redIcon' : 'islands#redFoodIcon');
          });
          
          // Update count
          document.getElementById('count').textContent = `${filteredShops.length} найдено`;
          
          // If only one result, center map on it
          if (filteredShops.length === 1) {
            map.setCenter(filteredShops[0].coords, map.getZoom());
          }
          
          // Add search active class to container
          searchInput.parentElement.classList.add('search-active');
        } else {
          clearSearch();
        }
      }
      
      function clearSearch() {
        // Clear input
        searchInput.value = '';
        
        // Hide clear button
        clearButton.classList.add('hidden');
        
        // Show all placemarks and restore original icon
        coffeeShops.forEach(shop => {
          shop.placemark.options.set('visible', true);
          shop.placemark.options.set('preset', currentVenueType === 'coffee' ? 'islands#blueIcon' : 'islands#orangeFoodIcon');
        });
        
        // Update count
        document.getElementById('count').textContent = `${coffeeShops.length} найдено`;
        
        // Remove search active class
        searchInput.parentElement.classList.remove('search-active');
      }
    }
    
    // Массив уникальных фотографий для кофеен
    const coffeeShopImages = {
      "Десертомания": "https://images.unsplash.com/photo-1587314168485-3236d6710814?auto=format&fit=crop&w=400&h=250",
      "Кофе и Книги": "https://images.unsplash.com/photo-1600093463592-8e36ae95ef56?auto=format&fit=crop&w=400&h=250",
      "Кофейня": "https://images.unsplash.com/photo-1501339847302-ac426a4a7cbb?auto=format&fit=crop&w=400&h=250",
      "Coffee Like": "https://images.unsplash.com/photo-1600565193348-f74bd3c7ccdf?auto=format&fit=crop&w=400&h=250",
      "Арт-кофейня": "https://images.unsplash.com/photo-1554118811-1e0d58224f24?auto=format&fit=crop&w=400&h=250",
      "Bar": "https://images.unsplash.com/photo-1559925393-8be0ec4767c8?auto=format&fit=crop&w=400&h=250",
      "Ё кофе": "https://images.unsplash.com/photo-1600093463592-8e36ae95ef56?auto=format&fit=crop&w=400&h=250",
      "Кофейные моменты": "https://images.unsplash.com/photo-1600431521340-491eca880813?auto=format&fit=crop&w=400&h=250",
      "Кофейня на Воровского": "https://images.unsplash.com/photo-1600939288837-6c42922adf16?auto=format&fit=crop&w=400&h=250",
      "Кофейня на Ленина": "https://images.unsplash.com/photo-1600939288440-d498458bd0c9?auto=format&fit=crop&w=400&h=250",
      "Кофейня на Московской": "https://images.unsplash.com/photo-1600939288343-31a2a3d4a612?auto=format&fit=crop&w=400&h=250",
      "Coffee House": "https://images.unsplash.com/photo-1600939288689-1e81c1a1b964?auto=format&fit=crop&w=400&h=250",
      "Кофейня у Филармонии": "https://images.unsplash.com/photo-1600939288689-1e81c1a1b964?auto=format&fit=crop&w=400&h=250"
    };

    // Функция для получения случайного изображения из массива
    function getRandomImage(name) {
      const images = [
        "https://images.unsplash.com/photo-1600093463592-8e36ae95ef56?auto=format&fit=crop&w=400&h=250",
        "https://images.unsplash.com/photo-1559925393-8be0ec4767c8?auto=format&fit=crop&w=400&h=250",
        "https://images.unsplash.com/photo-1600431521340-491eca880813?auto=format&fit=crop&w=400&h=250",
        "https://images.unsplash.com/photo-1600939288837-6c42922adf16?auto=format&fit=crop&w=400&h=250",
        "https://images.unsplash.com/photo-1600939288440-d498458bd0c9?auto=format&fit=crop&w=400&h=250",
        "https://images.unsplash.com/photo-1600939288343-31a2a3d4a612?auto=format&fit=crop&w=400&h=250",
        "https://images.unsplash.com/photo-1600939288689-1e81c1a1b964?auto=format&fit=crop&w=400&h=250",
        "https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?auto=format&fit=crop&w=400&h=250",
        "https://images.unsplash.com/photo-1509042239860-f550ce710b93?auto=format&fit=crop&w=400&h=250",
        "https://images.unsplash.com/photo-1511920170033-f8396924c348?auto=format&fit=crop&w=400&h=250",
        "https://images.unsplash.com/photo-1453614512568-c4024d13c247?auto=format&fit=crop&w=400&h=250",
        "https://images.unsplash.com/photo-1442512595331-e89e73853f31?auto=format&fit=crop&w=400&h=250",
        "https://images.unsplash.com/photo-1481627834876-b7833e8f5570?auto=format&fit=crop&w=400&h=250",
        "https://images.unsplash.com/photo-1554118811-1e0d58224f24?auto=format&fit=crop&w=400&h=250",
        "https://images.unsplash.com/photo-1587314168485-3236d6710814?auto=format&fit=crop&w=400&h=250"
      ];
      
      // Используем хеш имени заведения для получения стабильного индекса
      const hash = name.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);
      return images[hash % images.length];
    }

    function createBalloonContent(name, address, hours, distance) {
      const distanceText = distance ? 'Расстояние: ' + formatDistance(distance) : '';
      const escapedName = name.replace(/'/g, "\\'");
      const escapedAddress = address.replace(/'/g, "\\'");
      const escapedHours = hours.replace(/'/g, "\\'");
      
      // Получаем уникальное изображение для заведения
      const imageUrl = getRandomImage(name);
      const imageHtml = '<div class="balloon-image"><img src="' + imageUrl + '" alt="' + escapedName + '" style="width: 100%; height: 150px; object-fit: cover; border-radius: 8px 8px 0 0;"></div>';
      
      return '<div class="custom-balloon">' +
             imageHtml +
             '<div class="balloon-title">' + escapedName + '</div>' +
             '<div class="balloon-address">' + escapedAddress + '</div>' +
             '<div class="balloon-hours">' + escapedHours + '</div>' +
             (distanceText ? '<div class="balloon-distance">' + distanceText + '</div>' : '') +
             '<button class="balloon-button" onclick="openPreorderForm(\'' + escapedName + '\', \'' + escapedAddress + '\', \'' + escapedHours + '\')">' +
             '<svg viewBox="0 0 24 24" width="16" height="16">' +
             '<path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/>' +
             '</svg>' +
             'Предзаказ' +
             '</button>' +
             '</div>';
    }
    
    // Find nearest venue and zoom to user location
    function findNearestAndZoomToUser() {
      // Always request new location when button is clicked
      getUserLocation().then(() => {
        // First zoom to user location
        map.setCenter(userLocation, 16);
        
        // Then find nearest venue
        findNearest();
      }).catch(error => {
        showError('Невозможно определить ваше местоположение');
      });
    }
    
    // Find nearest venue
    function findNearest() {
      if (!userLocation || coffeeShops.length === 0) {
        showError('Невозможно найти ближайшее заведение');
        return;
      }
      
      let nearestShop = null;
      let minDistance = Infinity;
      
      // Calculate distances to all venues
      coffeeShops.forEach(shop => {
        const distance = ymaps.coordSystem.geo.getDistance(userLocation, shop.coords);
        
        if (distance < minDistance) {
          minDistance = distance;
          nearestShop = shop;
          nearestShop.distance = distance;
        }
      });
      
      if (nearestShop) {
        // Store current nearest shop
        currentNearestShop = nearestShop;
        
        // Only show route if venue type is coffee
        if (currentVenueType === 'coffee') {
          updateRouteToShop(nearestShop);
        } else {
          // For shawarma, just update the route without showing info panel
          if (currentRoute) {
            map.geoObjects.remove(currentRoute);
          }
          const multiRoute = new ymaps.multiRouter.MultiRoute({
            referencePoints: [userLocation, nearestShop.coords],
            params: { routingMode: 'pedestrian', avoidTrafficJams: false }
          }, {
            boundsAutoApply: false,
            wayPointVisible: false,
            routeActiveStrokeColor: "#795548",
            routeActiveStrokeWidth: 4
          });
          map.geoObjects.add(multiRoute);
          currentRoute = multiRoute;
        }
        
        // Show a brief notification about the nearest shop
        showSuccess(`Найдено ближайшее заведение: ${nearestShop.name} (${formatDistance(nearestShop.distance)})`);
      }
    }
    
    // Show route to venue
    function showRouteToShop(shop) {
      // Check if user location is available
      if (!userLocation) {
        showError('Невозможно построить маршрут: определите ваше местоположение');
        return;
      }
      
      // Обновляем маршрут
      updateRouteToShop(shop);
      
      // Store current shop for pre-order
      currentShop = {
        name: shop.name,
        address: shop.address,
        hours: shop.hours,
        coords: shop.coords
      };
      
    }
    
    // Show info panel with shop details
    function showInfoPanel(shop) {
      const infoPanel = document.getElementById('infoPanel');
      const infoTitle = document.getElementById('infoTitle');
      const infoAddress = document.getElementById('infoAddress');
      const infoHours = document.getElementById('infoHours');
      const infoDistance = document.getElementById('infoDistance');
      
      // Set shop details
      infoTitle.textContent = shop.name;
      infoAddress.textContent = shop.address;
      infoHours.textContent = shop.hours;
      
      // Format distance
      if (shop.distance) {
        infoDistance.textContent = `Расстояние: ${formatDistance(shop.distance)}`;
      } else {
        infoDistance.textContent = '';
      }
      
      // Показываем панель
      infoPanel.classList.add('visible');
    }
    
    // Open pre-order form from info panel
    function openPreorderFormFromInfo() {
      if (currentShop) {
        openPreorderForm(currentShop.name, currentShop.address, currentShop.hours);
      }
    }
    
    // Open pre-order form
    function openPreorderForm(shopName, shopAddress, shopHours) {
      console.log('Opening pre-order form for:', shopName); // Debug log
      
      // Store current shop for pre-order
      currentShop = {
        name: shopName,
        address: shopAddress,
        hours: shopHours
      };

      // Reset selected items
      selectedDrink = null;
      selectedDessert = null;
      selectedExtras = [];
      totalPrice = 0;

      // Update form content
      document.getElementById('preorderTitle').textContent = 'Предзаказ';
      document.getElementById('preorderSubtitle').textContent = shopName + ' (' + shopHours + ')';
      
      // Show overlay
      const overlay = document.getElementById('preorderOverlay');
      if (overlay) {
        overlay.classList.remove('hidden');
      } else {
        console.error('Overlay element not found!');
      }

      // Generate menu content
      const menuContent = generateMenuContent();
      const contentElement = document.getElementById('preorderContent');
      if (contentElement) {
        contentElement.innerHTML = menuContent;
      } else {
        console.error('Content element not found!');
      }
    }

    function generateMenuContent() {
      let coldDrinksCard = '';
      let dessertsCard = '';
      let sandwichesCard = '';
      let icecreamCard = '';
      if (currentShop && currentShop.name === "RJ Coffee") {
        coldDrinksCard = `
          <div class="category-card" onclick="showCategory('colddrinks')">
            <img src="https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=400" alt="Холодные напитки">
            <div class="category-card-content">
              <div class="category-card-title">Холодные напитки</div>
              <div class="category-card-description">Освежающие кофейные и молочные напитки</div>
            </div>
            <div class="category-counter" id="colddrinks-counter">0</div>
          </div>
        `;
        // Не добавляем десерты, сэндвичи, мороженое
      } else {
        dessertsCard = `
          <div class="category-card" onclick="showCategory('desserts')">
            <img src="https://images.unsplash.com/photo-1488477181946-6428a0291777?auto=format&fit=crop&w=400" alt="Десерты">
            <div class="category-card-content">
              <div class="category-card-title">Десерты</div>
              <div class="category-card-description">Свежая выпечка и десерты</div>
            </div>
            <div class="category-counter" id="desserts-counter">0</div>
          </div>
        `;
        sandwichesCard = `
          <div class="category-card" onclick="showCategory('sandwiches')">
            <img src="https://images.unsplash.com/photo-1528735602780-2552fd46c7af?auto=format&fit=crop&w=400" alt="Сэндвичи">
            <div class="category-card-content">
              <div class="category-card-title">Сэндвичи</div>
              <div class="category-card-description">Свежие и вкусные сэндвичи</div>
            </div>
            <div class="category-counter" id="sandwiches-counter">0</div>
          </div>
        `;
        icecreamCard = `
          <div class="category-card" onclick="showCategory('icecream')">
            <img src="https://images.unsplash.com/photo-1501443762994-82bd5dace89a?auto=format&fit=crop&w=400" alt="Мороженое">
            <div class="category-card-content">
              <div class="category-card-title">Мороженое</div>
              <div class="category-card-description">Классическое и особое мороженое</div>
            </div>
            <div class="category-counter" id="icecream-counter">0</div>
          </div>
        `;
      }
      return `
        <div id="categoryView" class="active-view">
          <div class="category-cards">
            <div class="category-card" onclick="showCategory('drinks')">
              <img src="https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?auto=format&fit=crop&w=400" alt="Напитки">
              <div class="category-card-content">
                <div class="category-card-title">Напитки</div>
                <div class="category-card-description">Кофе, чай и другие напитки</div>
              </div>
              <div class="category-counter" id="drinks-counter">0</div>
            </div>
            ${dessertsCard}
            ${sandwichesCard}
            ${icecreamCard}
            ${coldDrinksCard}
          </div>
        </div>

        <div id="drinksCategory" class="category-items">
          <div class="category-header">
            <button class="back-to-categories" onclick="showCategories()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6"/>
              </svg>
            </button>
            <h2 class="category-title">Напитки</h2>
          </div>
          <div class="menu-items">
            <div class="menu-item" data-id="americano" data-type="drink" data-price="150" onclick="selectMenuItem(this, 'drink')">
              <img src="https://images.unsplash.com/photo-1518832553480-cd0e625ed3e6?auto=format&fit=crop&w=300" alt="Американо" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Американо</div>
                  <div class="menu-item-price">150 ₽</div>
                </div>
              </div>
              <div class="menu-item-footer">
                <select class="volume-select" onchange="updateDrinkPrice('americano', this.value)" onclick="event.stopPropagation()">
                  <option value="small">200 мл</option>
                  <option value="medium" selected>300 мл</option>
                  <option value="large">400 мл</option>
                </select>
              </div>
            </div>
            <div class="menu-item" data-id="cappuccino" data-type="drink" data-price="180" onclick="selectMenuItem(this, 'drink')">
              <video autoplay loop muted playsinline class="menu-item-image" poster="https://images.unsplash.com/photo-1534778101976-62847782c213?auto=format&fit=crop&w=300">
                <source src="https://player.vimeo.com/external/368688126.sd.mp4?s=e89421b74f3f8b6d8b0e42c8c3a0d6b5c6e7f6c9&profile_id=164&oauth2_token_id=57447761" type="video/mp4">
              </video>
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Капучино</div>
                  <div class="menu-item-price">180 ₽</div>
                </div>
              </div>
              <div class="menu-item-footer">
                <select class="volume-select" onchange="updateDrinkPrice('cappuccino', this.value)" onclick="event.stopPropagation()">
                  <option value="small">200 мл</option>
                  <option value="medium" selected>300 мл</option>
                  <option value="large">400 мл</option>
                </select>
              </div>
            </div>
            <div class="menu-item" data-id="latte" data-type="drink" data-price="200" onclick="selectMenuItem(this, 'drink')">
              <img src="https://images.unsplash.com/photo-1570968915860-54d5c301fa9f?auto=format&fit=crop&w=300" alt="Латте" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Латте</div>
                  <div class="menu-item-price">200 ₽</div>
                </div>
              </div>
              <div class="menu-item-footer">
                <select class="volume-select" onchange="updateDrinkPrice('latte', this.value)" onclick="event.stopPropagation()">
                  <option value="small">200 мл</option>
                  <option value="medium" selected>300 мл</option>
                  <option value="large">400 мл</option>
                </select>
              </div>
            </div>
            <div class="menu-item" data-id="espresso" data-type="drink" data-price="120" onclick="selectMenuItem(this, 'drink')">
              <img src="https://images.unsplash.com/photo-1510591509098-f4fdc6d0ff04?auto=format&fit=crop&w=300" alt="Эспрессо" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Эспрессо</div>
                  <div class="menu-item-price">120 ₽</div>
                </div>
              </div>
              <div class="menu-item-footer">
                <select class="volume-select" onchange="updateDrinkPrice('espresso', this.value)" onclick="event.stopPropagation()">
                  <option value="small">30 мл</option>
                  <option value="medium" selected>60 мл</option>
                  <option value="large">90 мл</option>
                </select>
              </div>
            </div>
          </div>
        </div>

        <div id="dessertsCategory" class="category-items">
          <div class="category-header">
            <button class="back-to-categories" onclick="showCategories()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6"/>
              </svg>
            </button>
            <h2 class="category-title">Десерты</h2>
          </div>
          <div class="menu-items">
            <div class="menu-item" data-id="cheesecake" data-type="dessert" data-price="250" onclick="selectMenuItem(this, 'dessert')">
              <img src="https://images.unsplash.com/photo-1508737027454-e6454ef45b50?auto=format&fit=crop&w=300" alt="Чизкейк" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Чизкейк Нью-Йорк</div>
                  <div class="menu-item-price">250 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="tiramisu" data-type="dessert" data-price="280" onclick="selectMenuItem(this, 'dessert')">
              <img src="https://images.unsplash.com/photo-1571877227200-a0d98ea607e9?auto=format&fit=crop&w=300" alt="Тирамису" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Тирамису</div>
                  <div class="menu-item-price">280 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="brownie" data-type="dessert" data-price="220" onclick="selectMenuItem(this, 'dessert')">
              <img src="https://images.unsplash.com/photo-1564355808539-22fda35bed7e?auto=format&fit=crop&w=300" alt="Брауни" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Брауни</div>
                  <div class="menu-item-price">220 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="eclair" data-type="dessert" data-price="180" onclick="selectMenuItem(this, 'dessert')">
              <img src="https://images.unsplash.com/photo-1558326567-98ae2405596b?auto=format&fit=crop&w=300" alt="Эклер" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Эклер</div>
                  <div class="menu-item-price">180 ₽</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="sandwichesCategory" class="category-items">
          <div class="category-header">
            <button class="back-to-categories" onclick="showCategories()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6"/>
              </svg>
            </button>
            <h2 class="category-title">Сэндвичи</h2>
          </div>
          <div class="menu-items">
            <div class="menu-item" data-id="club" data-type="sandwich" data-price="320" onclick="selectMenuItem(this, 'sandwich')">
              <img src="https://images.unsplash.com/photo-1528735602780-2552fd46c7af?auto=format&fit=crop&w=300" alt="Клаб-сэндвич" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Клаб-сэндвич</div>
                  <div class="menu-item-price">320 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="chicken" data-type="sandwich" data-price="280" onclick="selectMenuItem(this, 'sandwich')">
              <img src="https://images.unsplash.com/photo-1521390188846-e2a3a97453a0?auto=format&fit=crop&w=300" alt="Сэндвич с курицей" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Сэндвич с курицей</div>
                  <div class="menu-item-price">280 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="tuna" data-type="sandwich" data-price="290" onclick="selectMenuItem(this, 'sandwich')">
              <img src="https://images.unsplash.com/photo-1485451456034-3f9391c6f769?auto=format&fit=crop&w=300" alt="Сэндвич с тунцом" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Сэндвич с тунцом</div>
                  <div class="menu-item-price">290 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="veggie" data-type="sandwich" data-price="250" onclick="selectMenuItem(this, 'sandwich')">
              <img src="https://images.unsplash.com/photo-1540713434306-58505cf1b6fc?auto=format&fit=crop&w=300" alt="Вегетариан" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Вегетариан сэндвич</div>
                  <div class="menu-item-price">250 ₽</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="icecreamCategory" class="category-items">
          <div class="category-header">
            <button class="back-to-categories" onclick="showCategories()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6"/>
              </svg>
            </button>
            <h2 class="category-title">Мороженое</h2>
          </div>
          <div class="menu-items">
            <div class="menu-item" data-id="vanilla" data-type="icecream" data-price="150" onclick="selectMenuItem(this, 'icecream')">
              <img src="https://images.unsplash.com/photo-1570197788417-0e82375c9371?auto=format&fit=crop&w=300" alt="Ванильное" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Ванильное мороженое</div>
                  <div class="menu-item-price">150 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="chocolate" data-type="icecream" data-price="150" onclick="selectMenuItem(this, 'icecream')">
              <img src="https://images.unsplash.com/photo-1563805042-7684c019e1cb?auto=format&fit=crop&w=300" alt="Шоколадное" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Шоколадное мороженое</div>
                  <div class="menu-item-price">150 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="sundae" data-type="icecream" data-price="280" onclick="selectMenuItem(this, 'icecream')">
              <img src="https://images.unsplash.com/photo-1563805042-7684c019e1cb?auto=format&fit=crop&w=300" alt="Сандей" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Сандей с топпингами</div>
                  <div class="menu-item-price">280 ₽</div>
                </div>
              </div>
            </div>
            <div class="menu-item" data-id="affogato" data-type="icecream" data-price="220" onclick="selectMenuItem(this, 'icecream')">
              <div class="particles">
                <div class="particle particle-1"></div>
                <div class="particle particle-2"></div>
                <div class="particle particle-3"></div>
                <div class="particle particle-4"></div>
                <div class="particle particle-5"></div>
                <div class="particle particle-6"></div>
              </div>
              <div class="coffee-ripple"></div>
              <div class="heat-effect"></div>
              <img src="https://images.unsplash.com/photo-1579954115545-a95591f28bfc?auto=format&fit=crop&w=300" alt="Аффогато" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Аффогато</div>
                  <div class="menu-item-price">220 ₽</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="colddrinksCategory" class="category-items">
          <div class="category-header">
            <button class="back-to-categories" onclick="showCategories()">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M15 18l-6-6 6-6"/>
              </svg>
            </button>
            <h2 class="category-title">Холодные напитки</h2>
          </div>
          <div class="menu-items">
            <div class="menu-item" data-id="icecoffee" data-type="colddrink" data-price="280" onclick="selectMenuItem(this, 'colddrink')">
              <img src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=300" alt="Айс-Кофе" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Айс-Кофе</div>
                  <div class="menu-item-price">280 ₽</div>
                </div>
              </div>
              <div class="menu-item-footer">350 мл</div>
            </div>
            <div class="menu-item" data-id="bumble" data-type="colddrink" data-price="330" onclick="selectMenuItem(this, 'colddrink')">
              <img src="https://images.unsplash.com/photo-1464983953574-0892a716854b?auto=format&fit=crop&w=300" alt="Бамбл" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Бамбл</div>
                  <div class="menu-item-price">330 ₽</div>
                </div>
              </div>
              <div class="menu-item-footer">450 мл</div>
            </div>
            <div class="menu-item" data-id="milkshake" data-type="colddrink" data-price="280" onclick="selectMenuItem(this, 'colddrink')">
              <img src="https://images.unsplash.com/photo-1519864600265-abb23847ef2c?auto=format&fit=crop&w=300" alt="Молочный коктейль" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Молочный коктейль</div>
                  <div class="menu-item-price">280 ₽</div>
                </div>
              </div>
              <div class="menu-item-footer">350 мл</div>
            </div>
            <div class="menu-item" data-id="coffeemilkshake" data-type="colddrink" data-price="290" onclick="selectMenuItem(this, 'colddrink')">
              <img src="https://images.unsplash.com/photo-1465101046530-73398c7f28ca?auto=format&fit=crop&w=300" alt="Кофейный милкшейк" class="menu-item-image">
              <div class="menu-item-content">
                <div class="menu-item-header">
                  <div class="menu-item-title">Кофейный милкшейк</div>
                  <div class="menu-item-price">290 ₽</div>
                </div>
              </div>
              <div class="menu-item-footer">350 мл</div>
            </div>
          </div>
        </div>

        <div class="time-slider-container">
          ${generateTimeSlider()}
        </div>

        <div class="form-group">
          <label class="form-label" for="comment">Комментарий к заказу</label>
          <input type="text" class="form-input" id="comment" placeholder="Например: без сахара">
        </div>

        <div class="form-footer">
          <div class="total-price" id="totalPrice">Итого: 0 ₽</div>
          <button class="submit-button" id="submitOrder" onclick="submitOrder()" disabled>Заказать</button>
        </div>
      `;
    }
    
    // Hide overlay
    function hideOverlay() {
      console.log("Hiding overlay");
      document.getElementById('preorderOverlay').classList.add('hidden');
      
      // Reset the form state
      currentShop = null;
      selectedDrink = null;
      selectedDessert = null;
      selectedExtras = [];
      totalPrice = 0;
      
      // Remove selection from all menu items
      document.querySelectorAll('.menu-item').forEach(item => {
        item.classList.remove('selected');
      });
      
      // Update counters and total price display
      updateCategoryCounters();
      document.getElementById('totalPrice').textContent = `Итого: ${totalPrice} ₽`;
    }
    
    // Toggle section collapse/expand
    function toggleSection(section) {
      section.classList.toggle('collapsed');
    }
    
    // Update time value display
    function updateTimeValue(value) {
      const timeValueElement = document.getElementById('timeValue');
      if (timeValueElement) {
        timeValueElement.textContent = 'через ' + value + ' минут';
      }
    }
    
    // Select menu item (drink or dessert)
    function selectMenuItem(element, type) {
      const itemId = element.dataset.id;
      const itemTitle = element.querySelector('.menu-item-title').textContent;
      const itemPrice = parseInt(element.dataset.price);

      // Особое поведение для американо, капучино, латте и эспрессо
      if (itemId === 'americano' || itemId === 'cappuccino' || itemId === 'latte' || itemId === 'espresso') {
        element.classList.toggle('selected');
        if (element.classList.contains('selected')) {
          totalPrice += itemPrice;
        } else {
          totalPrice = Math.max(0, totalPrice - itemPrice);
        }
        document.getElementById('totalPrice').textContent = `Итого: ${totalPrice} ₽`;
        updateCategoryCounters();
        updateSubmitButton();
        return;
      }

      // Для colddrink: выделяем только один, как для остальных категорий
      if (type === 'colddrink') {
        const wasSelected = element.classList.contains('selected');
        document.querySelectorAll('.menu-item[data-type="colddrink"]').forEach(item => {
          if (item !== element) {
            item.classList.remove('selected');
          }
        });
        if (wasSelected) {
          element.classList.remove('selected');
        } else {
          element.classList.add('selected');
        }
        updateTotalPrice();
        updateSubmitButton();
        updateCategoryCounters();
        return;
      }

      // Стандартное поведение для остальных товаров
      const wasSelected = element.classList.contains('selected');
      document.querySelectorAll(`.menu-item[data-type="${type}"]`).forEach(item => {
        if (item !== element) {
          item.classList.remove('selected');
        }
      });
      if (wasSelected) {
        element.classList.remove('selected');
        if (type === 'drink') {
          selectedDrink = null;
          clearExtrasForDrink(itemId);
          selectedExtras = [];
          const priceElement = element.querySelector('.menu-item-price');
          if (priceElement) {
            priceElement.textContent = `${itemPrice} ₽`;
          }
        } else if (type === 'dessert') {
          selectedDessert = null;
          totalPrice = Math.max(0, totalPrice - itemPrice);
        } else if (type === 'sandwich') {
          selectedSandwich = null;
          totalPrice = Math.max(0, totalPrice - itemPrice);
        } else if (type === 'icecream') {
          selectedIcecream = null;
          totalPrice = Math.max(0, totalPrice - itemPrice);
        }
        document.getElementById('totalPrice').textContent = `Итого: ${totalPrice} ₽`;
      } else {
        element.classList.add('selected');
        const selectedItem = {
          id: itemId,
          name: itemTitle,
          price: itemPrice
        };
        if (type === 'drink') {
          selectedDrink = selectedItem;
        } else if (type === 'dessert') {
          selectedDessert = selectedItem;
        } else if (type === 'sandwich') {
          selectedSandwich = selectedItem;
        } else if (type === 'icecream') {
          selectedIcecream = selectedItem;
        }
      }
      updateTotalPrice();
      updateSubmitButton();
      updateCategoryCounters();
    }

    // Update submit button state
    function updateSubmitButton() {
      const submitButton = document.getElementById('submitOrder');
      if (submitButton) {
        // Check for special drinks
        const specialDrinks = ['americano', 'cappuccino', 'latte', 'espresso'];
        const hasSpecialDrink = specialDrinks.some(drinkId => 
          document.querySelector(`.menu-item[data-id="${drinkId}"].selected`)
        );
        
        // Enable button if at least one item is selected
        submitButton.disabled = !(selectedDrink || hasSpecialDrink || selectedDessert || selectedSandwich || selectedIcecream);
        
        // Update button style based on state
        if (!submitButton.disabled) {
          submitButton.style.opacity = '1';
          submitButton.style.cursor = 'pointer';
        } else {
          submitButton.style.opacity = '0.5';
          submitButton.style.cursor = 'not-allowed';
        }
      }
    }

    function clearExtrasForDrink(drinkId) {
      const extrasContainer = document.getElementById('extrasSection');
      // Очищаем все чекбоксы
      const extraInputs = extrasContainer.querySelectorAll(`input[data-drink="${drinkId}"]`);
      extraInputs.forEach(input => {
        if (input.type === 'checkbox') {
          input.checked = false;
        }
      });
      // Убираем выделение со всех элементов extras
      document.querySelectorAll('.menu-item[data-type="extra"]').forEach(item => {
        item.classList.remove('selected');
      });
      // Восстанавливаем исходную цену напитка
      const drinkElement = document.querySelector(`.menu-item[data-id="${drinkId}"]`);
      if (drinkElement) {
        const basePrice = parseInt(drinkElement.dataset.price);
        const priceElement = drinkElement.querySelector('.menu-item-price');
        if (priceElement) {
          priceElement.textContent = `${basePrice} ₽`;
        }
      }
    }
    
    // Toggle extra
    function toggleExtra(element) {
      // Toggle selection
      element.classList.toggle('selected');
      
      // Update selected extras
      const extraId = element.dataset.id;
      const extraName = element.querySelector('.menu-item-title').textContent;
      const extraPrice = parseInt(element.dataset.price);
      
      if (element.classList.contains('selected')) {
        // Add to selected extras
        selectedExtras.push({
          id: extraId,
          name: extraName,
          price: extraPrice
        });
      } else {
        // Remove from selected extras
        selectedExtras = selectedExtras.filter(extra => extra.id !== extraId);
      }
      
      // Update total price
      updateTotalPrice();
    }
    
    // Update category counters
    function updateCategoryCounters() {
      // Счетчик для напитков (включая специальные напитки)
      const drinksCounter = document.getElementById('drinks-counter');
      const specialDrinks = ['americano', 'cappuccino', 'latte', 'espresso'];
      const selectedSpecialDrinks = specialDrinks.reduce((count, drinkId) => {
        const elements = document.querySelectorAll(`.menu-item[data-id="${drinkId}"].selected`);
        return count + (elements.length > 0 ? 1 : 0);
      }, 0);
      drinksCounter.textContent = selectedSpecialDrinks;
      drinksCounter.classList.toggle('visible', selectedSpecialDrinks > 0);

      // Счетчик для холодных напитков
      const colddrinksCounter = document.getElementById('colddrinks-counter');
      if (colddrinksCounter) {
        const selectedColddrinks = document.querySelectorAll('.menu-item[data-type="colddrink"].selected').length;
        colddrinksCounter.textContent = selectedColddrinks;
        colddrinksCounter.classList.toggle('visible', selectedColddrinks > 0);
      }

      // Счетчик для десертов
      const dessertsCounter = document.getElementById('desserts-counter');
      const selectedDesserts = document.querySelectorAll('.menu-item[data-type="dessert"].selected').length;
      dessertsCounter.textContent = selectedDesserts;
      dessertsCounter.classList.toggle('visible', selectedDesserts > 0);

      // Счетчик для сэндвичей
      const sandwichesCounter = document.getElementById('sandwiches-counter');
      const selectedSandwiches = document.querySelectorAll('.menu-item[data-type="sandwich"].selected').length;
      sandwichesCounter.textContent = selectedSandwiches;
      sandwichesCounter.classList.toggle('visible', selectedSandwiches > 0);

      // Счетчик для мороженого
      const icecreamCounter = document.getElementById('icecream-counter');
      const selectedIcecream = document.querySelectorAll('.menu-item[data-type="icecream"].selected').length;
      icecreamCounter.textContent = selectedIcecream;
      icecreamCounter.classList.toggle('visible', selectedIcecream > 0);
    }

    // Update total price
    function updateTotalPrice() {
      let price = 0; // Начинаем с нуля
      
      // Добавляем цены выбранных специальных напитков
      const specialDrinks = ['americano', 'cappuccino', 'latte', 'espresso'];
      specialDrinks.forEach(drinkId => {
        const drinkElement = document.querySelector(`.menu-item[data-id="${drinkId}"].selected`);
        if (drinkElement) {
          price += parseInt(drinkElement.dataset.price);
        }
      });
      
      // Добавляем цену обычного выбранного напитка (если есть)
      if (selectedDrink && !specialDrinks.includes(selectedDrink.id)) {
        price += selectedDrink.price;
      }
      
      // Добавляем цену дополнительных опций
      selectedExtras.forEach(extra => {
        price += extra.price;
      });
      
      // Добавляем цену десерта
      if (selectedDessert) {
        price += selectedDessert.price;
      }
      
      // Добавляем цену сэндвича
      const sandwichElement = document.querySelector('.menu-item[data-type="sandwich"].selected');
      if (sandwichElement) {
        price += parseInt(sandwichElement.dataset.price);
      }
      
      // Добавляем цену мороженого
      const icecreamElement = document.querySelector('.menu-item[data-type="icecream"].selected');
      if (icecreamElement) {
        price += parseInt(icecreamElement.dataset.price);
      }
      
      // Update total price
      totalPrice = price;
      document.getElementById('totalPrice').textContent = `Итого: ${totalPrice} ₽`;
    }
    

    
    // Submit order with pickup time
    function submitOrder() {
      // Проверяем, выбран ли хотя бы один товар
      const specialDrinks = ['americano', 'cappuccino', 'latte', 'espresso'];
      const hasSpecialDrink = specialDrinks.some(drinkId => 
        document.querySelector(`.menu-item[data-id="${drinkId}"].selected`)
      );
      
      if (!selectedDrink && !selectedDessert && !selectedSandwich && !selectedIcecream && !hasSpecialDrink) {
        console.log('No items selected');
        return;
      }
      
      // Get form data
      const comment = document.getElementById('comment').value;
      const pickupTime = document.getElementById('timeSlider').value;
      
      // Create order object
      const order = {
        shop: currentShop,
        items: [],
        comment,
        pickupTime: parseInt(pickupTime),
        totalPrice,
        timestamp: new Date().toISOString()
      };
      
      // Add selected drink if any
      if (selectedDrink) {
        order.items.push({
          type: 'drink',
          name: selectedDrink.name,
          extras: selectedExtras,
          price: selectedDrink.price
        });
      }
      
      // Добавляем американо, капучино, латте и эспрессо, если они выбраны
      const specialDrinksList = [
        { id: 'americano', name: 'Американо' },
        { id: 'cappuccino', name: 'Капучино' },
        { id: 'latte', name: 'Латте' },
        { id: 'espresso', name: 'Эспрессо' }
      ];
      
      specialDrinksList.forEach(drink => {
        const element = document.querySelector(`.menu-item[data-id="${drink.id}"]`);
        if (element && element.classList.contains('selected')) {
          order.items.push({
            type: 'drink',
            name: drink.name,
            extras: [],
            price: parseInt(element.dataset.price)
          });
        }
      });
      
      // Add selected dessert if any
      if (selectedDessert) {
        order.items.push({
          type: 'dessert',
          name: selectedDessert.name,
          price: selectedDessert.price
        });
      }

      // Add selected sandwich if any
      if (selectedSandwich) {
        order.items.push({
          type: 'sandwich',
          name: selectedSandwich.name,
          price: selectedSandwich.price
        });
      }

      // Add selected ice cream if any
      if (selectedIcecream) {
        order.items.push({
          type: 'icecream',
          name: selectedIcecream.name,
          price: selectedIcecream.price
        });
      }
      
      console.log('Order submitted:', order);
      
      // Add to user's orders history
      const now = new Date();
      const newOrder = {
        id: Math.floor(Math.random() * 100000),
        date: now.toISOString().split('T')[0],
        time: now.toTimeString().split(' ')[0].substring(0, 5),
        shop: order.shop.name,
        items: order.items.map(item => {
          if (item.type === 'drink') {
            return `${item.name}${item.extras.length > 0 ? ` + ${item.extras.map(e => e.name).join(', ')}` : ''}`;
          } else {
            return item.name;
          }
        }),
        pickupTime: order.pickupTime,
        total: totalPrice
      };
      
      userData.orders.unshift(newOrder);
      
      // Show success message
      showOrderSuccess(order);
      
      // Send data to Telegram Mini App if available
      if (tg) {
        tg.sendData(JSON.stringify({
          shop_name: order.shop.name,
          shop_address: order.shop.address,
          shop_hours: order.shop.hours,
          items: order.items,
          pickup_time: order.pickupTime,
          comment: comment,
          total_price: totalPrice,
          order_id: newOrder.id
        }));
      }

      // Function to retry failed requests
      const fetchWithRetry = async (url, options, maxRetries = 3) => {
        for (let i = 0; i < maxRetries; i++) {
          try {
            const response = await fetch(url, {
              ...options,
              mode: 'cors',
              headers: {
                ...options.headers,
                'Accept': 'application/json',
                'Content-Type': 'application/json',
              }
            });
            
            if (!response.ok) {
              const text = await response.text();
              throw new Error(`HTTP error! status: ${response.status}, body: ${text}`);
            }
            
            return response;
          } catch (error) {
            console.log(`Attempt ${i + 1} failed:`, error);
            if (i === maxRetries - 1) throw error;
            await new Promise(resolve => setTimeout(resolve, 1000 * (i + 1))); // Exponential backoff
          }
        }
      };

      // Prepare order data
      const orderData = {
  shop_name: currentShop.name,
  shop_address: currentShop.address,
  shop_hours: currentShop.hours,
  items: order.items,
  pickup_time: order.pickupTime,
  comment: comment,
  total_price: totalPrice,
  order_id: newOrder.id,
  customer_name: userData.name,
  customer_phone: userData.phone
};
      // First try the API endpoint
      fetchWithRetry('https://kzmnhppkahlyl5mup7js.lite.vusercontent.net/api/orders', {
        method: 'POST',
        body: JSON.stringify(orderData)
      })
      .then(response => response.json())
      .then(data => {
        console.log('Order sent to external website:', data);
        
        // Then try the webhook
        return fetchWithRetry('https://kzmnhppkahlyl5mup7js.lite.vusercontent.net/api/webhook', {
          method: 'POST',
          body: JSON.stringify({
            type: 'new_order',
            ...orderData
          })
        });
      })
      .then(webhookResponse => {
        console.log('Webhook Response status:', webhookResponse.status);
        
        // Show success notification
        const notification = document.createElement('div');
        notification.className = 'success';
        notification.textContent = 'Заказ успешно отправлен на сайт';
        document.body.appendChild(notification);
        setTimeout(() => {
          notification.remove();
        }, 3000);
      })
      .catch(error => {
        console.error('Detailed error when sending order:', error);
        
        // Try alternative endpoint if main endpoints fail
        return fetch('https://v0-site-for-order-imports.vercel.app/', {
          method: 'POST',
          mode: 'cors',
          headers: {
            'Accept': 'application/json',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(orderData)
        })
        .then(response => {
          if (response.ok) {
            const notification = document.createElement('div');
            notification.className = 'success';
            notification.textContent = 'Заказ отправлен через альтернативный канал';
            document.body.appendChild(notification);
            setTimeout(() => {
              notification.remove();
            }, 3000);
          } else {
            throw new Error('Alternative endpoint also failed');
          }
        })
        .catch(finalError => {
          // Show error notification with more details
          const notification = document.createElement('div');
          notification.className = 'error';
          notification.textContent = 'Ошибка при отправке заказа. Пожалуйста, проверьте подключение к интернету или попробуйте позже.';
          document.body.appendChild(notification);
          setTimeout(() => {
            notification.remove();
          }, 5000);
        });
      });
    }
    
    // Show order success message
    function showOrderSuccess(order) {
      // Create items list HTML
      const itemsHtml = order.items.map(item => {
        if (item.type === 'drink') {
          const extrasText = item.extras.length > 0
            ? `<p>Дополнительно: ${item.extras.map(e => e.name).join(', ')}</p>`
            : '';
            
          return `
            <p>Напиток: ${item.name}</p>
            ${extrasText}
          `;
        } else if (item.type === 'dessert') {
          return `<p>Десерт: ${item.name}</p>`;
        } else if (item.type === 'sandwich') {
          return `<p>Сэндвич: ${item.name}</p>`;
        } else if (item.type === 'icecream') {
          return `<p>Мороженое: ${item.name}</p>`;
        }
      }).join('');
      
      const commentText = order.comment
        ? `<p>Комментарий: ${order.comment}</p>`
        : '';
      
      // Update content
      document.getElementById('preorderContent').innerHTML = `
        <div class="order-success">
          <div class="success-icon">
            <svg viewBox="0 0 24 24">
              <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z" fill="currentColor"/>
            </svg>
          </div>
          <div class="success-title">Заказ принят!</div>
          <div class="success-message">
            <p>Ваш заказ успешно отправлен в "${order.shop.name}".</p>
            <p>Адрес: ${order.shop.address}</p>
            <p>Время работы: ${order.shop.hours}</p>
            ${itemsHtml}
            ${commentText}
            <p>Время получения: через ${order.pickupTime} минут</p>
            <p>Сумма заказа: ${order.totalPrice} ₽</p>
            <p>Время заказа: ${new Date().toLocaleTimeString()}</p>
          </div>
          <button class="success-button" onclick="hideOverlay()">Готово</button>
        </div>
      `;
      
      // Update form title
      document.getElementById('preorderTitle').textContent = 'Заказ оформлен';
      document.getElementById('preorderSubtitle').textContent = '';

      // Reset the order state
      currentShop = null;
      selectedDrink = null;
      selectedDessert = null;
      selectedExtras = [];
      totalPrice = 0;
    }

    // Setup sidebar
    function setupSidebar() {
      // Get elements
      const menuButton = document.getElementById('menuButton');
      const sidebar = document.getElementById('sidebar');
      const sidebarOverlay = document.getElementById('sidebarOverlay');
      
      // Add event listeners
      menuButton.addEventListener('click', openSidebar);
      
      // Show main menu by default
      showMainMenu();
    }
    
    // Open sidebar
    function openSidebar() {
      const sidebar = document.getElementById('sidebar');
      const sidebarOverlay = document.getElementById('sidebarOverlay');
      
      sidebar.classList.add('visible');
      sidebarOverlay.classList.add('visible');
      
      // Show main menu
      showMainMenu();
    }
    
    // Close sidebar
    function closeSidebar() {
      const sidebar = document.getElementById('sidebar');
      const sidebarOverlay = document.getElementById('sidebarOverlay');
      
      sidebar.classList.remove('visible');
      sidebarOverlay.classList.remove('visible');
    }
    
    // Show main menu
    function showMainMenu() {
      // Update sidebar title
      document.getElementById('sidebarTitle').textContent = currentVenueType === 'coffee' ? 'Кофейни Кирова' : 'Шаурмичные Кирова';
      
      // Hide back button
      document.getElementById('sidebarBack').style.visibility = 'hidden';
      
      // Update user data in sidebar
      const sidebarContent = document.getElementById('sidebarContent');
      
      sidebarContent.innerHTML = `
        <div class="user-profile">
          <div class="user-avatar">
            ${userData.avatar ? 
              `<img src="${userData.avatar}" alt="Аватар пользователя">` :
              `<svg width="60" height="60" viewBox="0 0 60 60" fill="none" xmlns="http://www.w3.org/2000/svg">
                <circle cx="30" cy="30" r="30" fill="#E3F2FD"/>
                <path d="M30 15C32.7614 15 35 17.2386 35 20C35 22.7614 32.7614 25 30 25C27.2386 25 25 22.7614 25 20C25 17.2386 27.2386 15 30 15ZM30 28.75C36.9037 28.75 42.5 34.3463 42.5 41.25V45H17.5V41.25C17.5 34.3463 23.0963 28.75 30 28.75Z" fill="#2196F3"/>
              </svg>`}
          </div>
          <div class="user-info">
            <div class="user-name">${userData.name || 'Гость'}</div>
            <div class="user-phone">${userData.phone || ''}</div>
            <div class="user-id">${userData.id ? 'ID ' + userData.id : ''}</div>
          </div>
        </div>
        
        <div class="menu-list">
          <div class="menu-item-sidebar" onclick="showOrders()">
            <div class="menu-icon orders">
              <svg viewBox="0 0 24 24">
                <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-5 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
              </svg>
            </div>
            <div class="menu-text">Мои заказы</div>
            <div class="menu-arrow">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 18l6-6-6-6"/>
              </svg>
            </div>
          </div>
          
          <div class="menu-item-sidebar">
            <div class="menu-icon balance">
              <svg viewBox="0 0 24 24">
                <path d="M21 18v1c0 1.1-.9 2-2 2H5c-1.1 0-2-.9-2-2V5c0-1.1.9-2 2-2h14c1.1 0 2 .9 2 2v1h-9c-1.1 0-2 .9-2 2v8c0 1.1.9 2 2 2h9zm-9-2h10V8H12v8zm4-2.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/>
              </svg>
            </div>
            <div class="menu-text">Баланс</div>
            <div class="menu-value">${userData.balance.toFixed(2)} ₽</div>
          </div>
          
          <div class="menu-item-sidebar" onclick="showReferral()">
            <div class="menu-icon referral">
              <svg viewBox="0 0 24 24">
                <path d="M16 11c1.66 0 2.99-1.34 2.99-3S17.66 5 16 5c-1.66 0-3 1.34-3 3s1.34 3 3 3zm-8 0c1.66 0 2.99-1.34 2.99-3S9.66 5 8 5C6.34 5 5 6.34 5 8s1.34 3 3 3zm0 2c-2.33 0-7 1.17-7 3.5V19h14v-2.5c0-2.33-4.67-3.5-7-3.5zM8 11c-.29 0-.62.02-.97.05 1.16.84 1.97 1.97 1.97 3.45V19h6v-2.5c0-2.33-4.67-3.5-7-3.5z"/>
              </svg>
            </div>
            <div class="menu-text">Партнерская программа</div>
            <div class="menu-arrow">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M9 18l6-6-6-6"/>
              </svg>
            </div>
          </div>
        </div>
        
        <div class="legal-links">
          <div class="support-button" onclick="showContactOptions()">
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92c-.5.51-.86.97-1.04 1.69-.08.32-.13.68-.13 1.14h-2v-.5c0-.46.08-.9.22-1.31.2-.58.53-1.1.95-1.52l1.24-1.26c.46-.44.68-1.1.55-1.8-.13-.72-.73-1.31-1.44-1.44-.78-.14-1.44.17-1.84.7-.4.54-.51 1.25-.33 1.91l-1.9.63c-.28-1.11-.05-2.2.5-3.03.78-1.16 2.06-1.88 3.45-1.88s2.67.72 3.45 1.88c.78 1.15.78 2.69 0 3.84-.24.35-.53.64-.82.92z"/>
            </svg>
            Поддержка
          </div>
          <div class="legal-link" onclick="showPrivacyPolicy()">Политика обработки данных</div>
          <div class="legal-link" onclick="showUserAgreement()">Пользовательское соглашение</div>
        </div>

        <div style="
          padding: 15px;
          text-align: center;
          color: var(--tg-theme-hint-color, #999999);
          font-size: 12px;
          margin-top: 20px;
          border-top: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
        ">
          ИП Пайметов Кирилл Евгеньевич ОГРНИП 325430000027633 ИНН 434585647865
        </div>
      `;
    }
    
    // Show orders
    function showOrders() {
      // Update sidebar title
      document.getElementById('sidebarTitle').textContent = 'Мои заказы';
      
      // Show back button
      document.getElementById('sidebarBack').style.visibility = 'visible';
      
      // Create orders content
      let ordersContent = '';
      
      if (userData.orders.length === 0) {
        ordersContent = `
          <div style="padding: 20px; text-align: center;">
            <p>У вас пока нет заказов</p>
          </div>
        `;
      } else {
        ordersContent = `<div style="padding: 16px;">`;
        
        userData.orders.forEach(order => {
          ordersContent += `
            <div style="margin-bottom: 16px; padding: 12px; border: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1)); border-radius: 8px;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <div style="font-weight: 600;">${order.shop}</div>
                <div style="color: var(--tg-theme-hint-color, #8e8e93);">${order.date} ${order.time}</div>
              </div>
              <div style="margin-bottom: 8px;">
                ${order.items.map(item => `<div>${item}</div>`).join('')}
              </div>
              <div style="display: flex; justify-content: space-between; font-weight: 600;">
                <div>Итого:</div>
                <div>${order.total} ₽</div>
              </div>
            </div>
          `;
        });
        
        ordersContent += '</div>';
      }
      
      // Update sidebar content
      document.getElementById('sidebarContent').innerHTML = ordersContent;
    }
    
    // Show referral
    function showReferral() {
      // Generate referral code if not exists
      if (!userData.referral.code) {
        generateReferralCode();
      }
      
      // Update sidebar title
      document.getElementById('sidebarTitle').textContent = 'Партнерская программа';
      
      // Show back button
      document.getElementById('sidebarBack').style.visibility = 'visible';
      
      // Create referral content
      const referralLink = `https://t.me/coffee_kirov_bot?start=${userData.referral.code}`;
      
      const referralContent = `
        <div style="padding: 20px;">
          <div style="margin-bottom: 20px;">
            <div style="font-weight: 600; margin-bottom: 8px;">Ваша реферальная ссылка:</div>
            <div style="display: flex; align-items: center;">
              <input type="text" value="${referralLink}" readonly style="flex: 1; padding: 8px; border: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1)); border-radius: 8px; margin-right: 8px;">
              <button onclick="copyReferralCode()" style="background-color: var(--tg-theme-button-color, #2481cc); color: var(--tg-theme-button-text-color, #ffffff); border: none; border-radius: 8px; padding: 8px 12px; cursor: pointer;">Копировать</button>
            </div>
          </div>
          <div style="margin-bottom: 20px;">
            <div style="font-weight: 600; margin-bottom: 8px;">Статистика:</div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
              <div>Приглашено пользователей:</div>
              <div>${userData.referral.invited}</div>
            </div>
            <div style="display: flex; justify-content: space-between;">
              <div>Заработано бонусов:</div>
              <div>${userData.referral.bonusEarned} ₽</div>
            </div>
          </div>
          <div>
            <div style="font-weight: 600; margin-bottom: 8px;">Как это работает:</div>
            <p style="margin-bottom: 8px;">1. Поделитесь своей реферальной ссылкой с друзьями</p>
            <p style="margin-bottom: 8px;">2. Когда друг сделает первый заказ, вы получите 50 бонусных рублей</p>
            <p>3. Бонусы можно использовать для оплаты заказов</p>
          </div>
        </div>
      `;
      
      // Update sidebar content
      document.getElementById('sidebarContent').innerHTML = referralContent;
    }
    
    // Generate referral code
    function generateReferralCode() {
      // Generate random code based on user ID and timestamp
      const timestamp = new Date().getTime().toString(36);
      const randomPart = Math.random().toString(36).substring(2, 8);
      
      // Use user ID if available, otherwise use random string
      const userPart = userData.id ? userData.id.toString(36) : Math.random().toString(36).substring(2, 6);
      
      // Combine parts
      userData.referral.code = `${userPart}${randomPart}${timestamp}`.substring(0, 10).toUpperCase();
    }
    
    // Copy referral code
    function copyReferralCode() {
      const referralLink = `https://t.me/coffee_kirov_bot?start=${userData.referral.code}`;
      navigator.clipboard.writeText(referralLink).then(() => {
        showSuccess('Реферальная ссылка скопирована');
      }).catch(err => {
        console.error('Не удалось скопировать ссылку:', err);
      });
    }
    
    // Setup dropdown menu
    function setupDropdownMenu() {
      const titleDropdownToggle = document.getElementById('titleDropdownToggle');
      const titleDropdown = document.getElementById('titleDropdown');
      const dropdownItems = document.querySelectorAll('.dropdown-item');
      
      // Toggle dropdown on click
      titleDropdownToggle.addEventListener('click', function(event) {
        // Prevent the click from being handled by the document click handler
        event.stopPropagation();
        titleDropdown.classList.toggle('visible');
      });
      
      // Close dropdown when clicking outside
      document.addEventListener('click', function(event) {
        titleDropdown.classList.remove('visible');
      });
      
      // Handle dropdown item click
      dropdownItems.forEach(item => {
        item.addEventListener('click', function(event) {
          // Prevent event bubbling
          event.stopPropagation();
          
          // Get venue type
          const venueType = this.dataset.type;
          
          // Update current venue type
          currentVenueType = venueType;
          
          // Update dropdown text
          document.getElementById('currentVenueType').textContent = venueType === 'coffee' ? 'Кофейни Кирова' : 'Шаурмичные Кирова';
          
          // Update active item
          dropdownItems.forEach(item => {
            item.classList.remove('active');
          });
          this.classList.add('active');
          
          // Close dropdown
          titleDropdown.classList.remove('visible');
          
          // Update sidebar title
          document.getElementById('sidebarTitle').textContent = venueType === 'coffee' ? 'Кофейни Кирова' : 'Шаурмичные Кирова';
          
          // Load venues
          loadVenues();
        });
      });
    }
    
    // Get user data from Telegram
    function getUserDataFromTelegram() {
      if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
        const user = tg.initDataUnsafe.user;
        
        // Update user data
        userData.name = user.first_name + (user.last_name ? ' ' + user.last_name : '');
        userData.id = user.id.toString();
        
        // Get user phone if available
        if (user.phone_number) {
          userData.phone = user.phone_number;
        }
        
        // Get user avatar if available
        if (user.photo_url) {
          userData.avatar = user.photo_url;
        }
        
        // Generate referral code
        generateReferralCode();
        
        // Update sidebar
        showMainMenu();
      }
    }
    
    // Make functions available globally
    window.openPreorderForm = openPreorderForm;
    window.openPreorderFormFromInfo = openPreorderFormFromInfo;
    window.hideOverlay = hideOverlay;
    window.selectCoffee = selectCoffee;
    window.toggleExtra = toggleExtra;
    window.updateTotalPrice = updateTotalPrice;
    window.submitOrder = submitOrder;
    window.openSidebar = openSidebar;
    window.closeSidebar = closeSidebar;
    window.showMainMenu = showMainMenu;
    window.showOrders = showOrders;
    window.showReferral = showReferral;
    window.copyReferralCode = copyReferralCode;

    function showReferralContent() {
      const referralContent = 
        '<div style="padding: 20px;">' +
          '<h2 style="margin-bottom: 16px;">Партнерская программа</h2>' +
          '<p style="margin-bottom: 12px;">Приглашайте друзей и получайте бонусы!</p>' +
          '<p style="margin-bottom: 12px;">Ваша реферальная ссылка:</p>' +
          '<div style="background: var(--tg-theme-secondary-bg-color, #f1f1f1); padding: 12px; border-radius: 8px; margin-bottom: 16px; word-break: break-all;">' +
            '<a href="' + referralLink + '" style="color: var(--tg-theme-link-color, #2481cc);">' + referralLink + '</a>' +
          '</div>' +
          '<div style="margin-bottom: 16px;">' +
            '<p style="margin-bottom: 8px;">Приглашено друзей: ' + userData.referral.invites + '</p>' +
            '<p>Заработано бонусов: ' + userData.referral.earnings + ' ₽</p>' +
          '</div>' +
          '<div style="font-size: 14px; color: var(--tg-theme-hint-color, #8e8e93);">' +
            '<p>За каждого приглашенного друга вы получаете 50 ₽ на счет.</p>' +
            '<p>Ваш друг также получит 50 ₽ на первый заказ!</p>' +
          '</div>' +
        '</div>';

      document.getElementById('preorderContent').innerHTML = referralContent;
      document.getElementById('preorderTitle').textContent = 'Партнерская программа';
      document.getElementById('preorderSubtitle').textContent = '';
      document.getElementById('preorderOverlay').classList.remove('hidden');
    }

    function formatOrderItem(item) {
      if (item.type === 'drink') {
        const sizeName = {
          small: 'маленький',
          medium: 'средний',
          large: 'большой'
        }[item.size];
        
        return item.name + ' (' + sizeName + ')' +
          (item.extras.length > 0 ? ' + ' + item.extras.map(e => e.name).join(', ') : '');
      }
      return item.name;
    }

    // Add new functions for category navigation
    function showCategory(category) {
      // Hide all views first
      document.getElementById('categoryView').classList.remove('active-view');
      document.querySelectorAll('.category-items').forEach(el => {
        el.classList.remove('active-view');
      });
      
      // Show the selected category
      const categoryElement = document.getElementById(`${category}Category`);
      if (categoryElement) {
        categoryElement.classList.add('active-view');
      }
    }

    function showCategories() {
      // Hide all category views
      document.querySelectorAll('.category-items').forEach(el => {
        el.classList.remove('active-view');
      });
      
      // Show the main category view
      const categoryView = document.getElementById('categoryView');
      if (categoryView) {
        categoryView.classList.add('active-view');
      }

      // Update counters when returning to categories
      updateCategoryCounters();
    }

    // Make functions available globally
    window.showCategory = showCategory;
    window.showCategories = showCategories;

    function generateDrinksItems() {
      const drinks = [
        {
          id: 'americano',
          name: 'Американо',
          price: 150,
          image: 'https://images.unsplash.com/photo-1518832553480-cd0e625ed3e6?auto=format&fit=crop&w=300'
        },
        {
          id: 'cappuccino',
          name: 'Капучино',
          price: 180,
          image: 'https://images.unsplash.com/photo-1534778101976-62847782c213?auto=format&fit=crop&w=300'
        },
        {
          id: 'latte',
          name: 'Латте',
          price: 200,
          image: 'https://images.unsplash.com/photo-1570968915860-54d5c301fa9f?auto=format&fit=crop&w=300'
        },
        {
          id: 'espresso',
          name: 'Эспрессо',
          price: 120,
          image: 'https://images.unsplash.com/photo-1510591509098-f4fdc6d0ff04?auto=format&fit=crop&w=300'
        }
      ];

      return drinks.map(drink => `
        <div class="menu-item" data-id="${drink.id}" data-price="${drink.price}" onclick="selectMenuItem(this, 'drink')">
          <img src="${drink.image}" alt="${drink.name}" class="menu-item-image">
          <div class="menu-item-content">
            <div class="menu-item-header">
              <div class="menu-item-title">${drink.name}</div>
              <div class="menu-item-price">${drink.price} ₽</div>
            </div>
          </div>
          <div class="menu-item-footer">
            <select class="volume-select" onchange="updateDrinkPrice('${drink.id}', this.value)" onclick="event.stopPropagation()">
              <option value="small">200 мл</option>
              <option value="medium" selected>300 мл</option>
              <option value="large">400 мл</option>
            </select>
          </div>
        </div>
      `).join('');
    }

    function generateDessertsItems() {
      const desserts = [
        {
          id: 'cheesecake',
          name: 'Чизкейк Нью-Йорк',
          price: 250,
          image: 'https://images.unsplash.com/photo-1508737027454-e6454ef45b50?auto=format&fit=crop&w=300'
        },
        {
          id: 'tiramisu',
          name: 'Тирамису',
          price: 280,
          image: 'https://images.unsplash.com/photo-1571877227200-a0d98ea607e9?auto=format&fit=crop&w=300'
        },
        {
          id: 'brownie',
          name: 'Брауни',
          price: 220,
          image: 'https://images.unsplash.com/photo-1564355808539-22fda35bed7e?auto=format&fit=crop&w=300'
        },
        {
          id: 'eclair',
          name: 'Эклер',
          price: 180,
          image: 'https://images.unsplash.com/photo-1558326567-98ae2405596b?auto=format&fit=crop&w=300'
        }
      ];

      return desserts.map(dessert => `
        <div class="menu-item" data-id="${dessert.id}" data-price="${dessert.price}" onclick="selectMenuItem(this, 'dessert')">
          <img src="${dessert.image}" alt="${dessert.name}" class="menu-item-image">
          <div class="menu-item-content">
            <div class="menu-item-header">
              <div class="menu-item-title">${dessert.name}</div>
              <div class="menu-item-price">${dessert.price} ₽</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    function generateSandwichItems() {
      const sandwiches = [
        {
          id: 'club',
          name: 'Клаб-сэндвич',
          price: 320,
          image: 'https://images.unsplash.com/photo-1528735602780-2552fd46c7af?auto=format&fit=crop&w=300'
        },
        {
          id: 'chicken',
          name: 'Сэндвич с курицей',
          price: 280,
          image: 'https://images.unsplash.com/photo-1521390188846-e2a3a97453a0?auto=format&fit=crop&w=300'
        },
        {
          id: 'tuna',
          name: 'Сэндвич с тунцом',
          price: 290,
          image: 'https://images.unsplash.com/photo-1485451456034-3f9391c6f769?auto=format&fit=crop&w=300'
        },
        {
          id: 'veggie',
          name: 'Вегетариан сэндвич',
          price: 250,
          image: 'https://images.unsplash.com/photo-1540713434306-58505cf1b6fc?auto=format&fit=crop&w=300'
        }
      ];

      return sandwiches.map(sandwich => `
        <div class="menu-item" data-id="${sandwich.id}" data-price="${sandwich.price}" onclick="selectMenuItem(this, 'sandwich')">
          <img src="${sandwich.image}" alt="${sandwich.name}" class="menu-item-image">
          <div class="menu-item-content">
            <div class="menu-item-header">
              <div class="menu-item-title">${sandwich.name}</div>
              <div class="menu-item-price">${sandwich.price} ₽</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    function generateIceCreamItems() {
      const icecreams = [
        {
          id: 'vanilla',
          name: 'Ванильное мороженое',
          price: 150,
          image: 'https://images.unsplash.com/photo-1570197788417-0e82375c9371?auto=format&fit=crop&w=300'
        },
        {
          id: 'chocolate',
          name: 'Шоколадное мороженое',
          price: 150,
          image: 'https://images.unsplash.com/photo-1563805042-7684c019e1cb?auto=format&fit=crop&w=300'
        },
        {
          id: 'sundae',
          name: 'Сандей с топпингами',
          price: 280,
          image: 'https://images.unsplash.com/photo-1563805042-7684c019e1cb?auto=format&fit=crop&w=300'
        },
        {
          id: 'affogato',
          name: 'Аффогато',
          price: 220,
          image: 'https://images.unsplash.com/photo-1579954115545-a95591f28bfc?auto=format&fit=crop&w=300'
        }
      ];

      return icecreams.map(icecream => `
        <div class="menu-item" data-id="${icecream.id}" data-price="${icecream.price}" onclick="selectMenuItem(this, 'icecream')">
          <img src="${icecream.image}" alt="${icecream.name}" class="menu-item-image">
          <div class="menu-item-content">
            <div class="menu-item-header">
              <div class="menu-item-title">${icecream.name}</div>
              <div class="menu-item-price">${icecream.price} ₽</div>
            </div>
          </div>
        </div>
      `).join('');
    }

    function generateTimeSlider() {
      return `
        <div class="time-slider-wrapper">
          <div class="time-slider-label">
            <span>Время получения заказа</span>
            <span id="timeValue">через 5 минут</span>
          </div>
          <input type="range" id="timeSlider" class="time-slider" min="5" max="20" step="5" value="5" oninput="handleTimeSliderChange(this.value)" onchange="handleTimeSliderChange(this.value)">
          <div class="time-marks">
            <span class="time-mark">5</span>
            <span class="time-mark">10</span>
            <span class="time-mark">15</span>
            <span class="time-mark">20</span>
          </div>
        </div>
      `;
    }

    // Единая функция инициализации слайдера
    function initializeTimeSlider() {
        const timeSlider = document.getElementById('timeSlider');
        
        if (!timeSlider) {
            console.error('Slider element not found');
            return;
        }

        // Устанавливаем начальное значение
        timeSlider.value = 5;
        handleTimeSliderChange(5);
    }

    // Initialize drink prices based on selected volumes
    function initializeDrinkPrices() {
      const specialDrinks = ['americano', 'cappuccino', 'latte', 'espresso'];
      specialDrinks.forEach(drinkId => {
        // Find all instances of this drink's cards
        const drinkElements = document.querySelectorAll(`[data-id="${drinkId}"]`);
        drinkElements.forEach(drinkElement => {
          const volumeSelect = drinkElement.querySelector('.volume-select');
          if (volumeSelect) {
            // Get the selected option's value (small/medium/large)
            const selectedVolume = volumeSelect.options[volumeSelect.selectedIndex].value;
            const price = drinkPrices[drinkId][selectedVolume];
            const priceElement = drinkElement.querySelector('.menu-item-price');
            if (priceElement) {
              priceElement.textContent = `${price} ₽`;
              drinkElement.dataset.price = price.toString();
            }
          }
        });
      });
    }

    // Единый обработчик загрузки страницы
    document.addEventListener('DOMContentLoaded', function() {
      console.log('DOM Content Loaded'); // Для отладки
      
      // Инициализация приложения
      initializeApp();
      
      // Инициализация меню
      document.getElementById('drinksItems').innerHTML = generateDrinksItems();
      document.getElementById('dessertsItems').innerHTML = generateDessertsItems();
      document.getElementById('sandwichItems').innerHTML = generateSandwichItems();
      document.getElementById('icecreamItems').innerHTML = generateIceCreamItems();
      
      // Инициализация слайдера времени
      setTimeout(() => {
        console.log('Initializing time slider'); // Для отладки
        initializeTimeSlider();
      }, 100);
      
      // Добавляем обработчики для кнопок и категорий
      document.getElementById('closeButton').addEventListener('click', function() {
        updateCategoryCounters();
      });
      
      document.querySelectorAll('.category-card').forEach(card => {
        card.addEventListener('click', function() {
          updateCategoryCounters();
        });
      });
      
      // Настраиваем UI
      setupUI();
      
      // Проверяем, загружен ли API Яндекс Карт
      if (checkYmapsLoaded()) {
        console.log('Yandex Maps API is loaded');
        ymaps.ready(initMap);
      } else {
        console.error('Yandex Maps API is not loaded');
        document.getElementById('loading').classList.add('hidden');
        document.getElementById('error').textContent = 'Ошибка при загрузке API Яндекс Карт. Проверьте подключение к интернету и попробуйте перезагрузить страницу.';
        document.getElementById('error').classList.remove('hidden');
      }
      
      // Обновляем счетчики категорий
      updateCategoryCounters();
    });

    // Initialize app
    function initializeApp() {
      // Reset all selections
      selectedDrink = null;
      selectedDessert = null;
      selectedExtras = [];
      totalPrice = 0;
      
      // Update UI
      updateTotalPrice();
      updateSubmitButton();
      updateCategoryCounters();
    }

    function toggleItemSelection(element) {
      element.classList.toggle('selected');
      updateCategoryCounters();
      updateTotalPrice();
    }

    function handleTimeSliderChange(value) {
      const timeValue = document.getElementById('timeValue');
      if (timeValue) {
        timeValue.textContent = `через ${value} минут`;
      }
    }

    // Show user agreement
    function showUserAgreement() {
      // Update sidebar title
      document.getElementById('sidebarTitle').textContent = 'Пользовательское соглашение';
      
      // Show back button
      document.getElementById('sidebarBack').style.visibility = 'visible';
      
      // Create user agreement content
      const agreementContent = `
        <div style="padding: 20px;">
          <h1 style="font-size: 20px; font-weight: 600; margin-bottom: 20px;">Пользовательское соглашение</h1>
          
          <p style="margin-bottom: 16px;">Настоящее Пользовательское соглашение (далее — «Соглашение») определяет условия использования сайта vkusnobot.ru (далее — «Сайт») и является официальным документом, регулирующим отношения между Администрацией Сайта и физическим лицом, использующим Сайт (далее — «Пользователь»).</p>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">1. Общие положения</h2>
          <p style="margin-bottom: 8px;">1.1. Использование Сайта возможно только на условиях, изложенных в настоящем Соглашении.</p>
          <p style="margin-bottom: 8px;">1.2. Оформляя заказ на Сайте, Пользователь подтверждает своё согласие с условиями настоящего Соглашения и обязуется их соблюдать.</p>
          <p style="margin-bottom: 16px;">1.3. Если Пользователь не согласен с условиями Соглашения, он обязан прекратить использование Сайта.</p>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">2. Термины и определения</h2>
          <p style="margin-bottom: 8px;">Сайт — интернет-ресурс vkusnobot.ru, предоставляющий Пользователям возможность поиска заведений, оформления предзаказов и оплаты через интернет-эквайринг.</p>
          <p style="margin-bottom: 8px;">Пользователь — физическое лицо, достигшее возраста 14 лет, использующее Сайт.</p>
          <p style="margin-bottom: 8px;">Заведение-партнёр — кафе, кофейня, шаурмичная или иное заведение, представленное на Сайте.</p>
          <p style="margin-bottom: 8px;">Предзаказ — заказ товара или услуги в заведении-партнёре с последующей оплатой через Сайт.</p>
          <p style="margin-bottom: 16px;">Администрация Сайта — лицо, осуществляющее управление Сайтом.</p>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">3. Предмет соглашения</h2>
          <p style="margin-bottom: 8px;">3.1. Сайт предоставляет Пользователю возможность поиска заведений, оформления предзаказов и оплаты выбранных товаров/услуг через интернет-эквайринг Альфа-Банка.</p>
          <p style="margin-bottom: 16px;">3.2. Сайт является агрегатором и не является исполнителем услуг питания. Ответственность за качество и исполнение заказа несёт соответствующее Заведение-партнёр.</p>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">4. Регистрация и обработка персональных данных</h2>
          <p style="margin-bottom: 8px;">4.1. Для оформления заказа Пользователь предоставляет следующие данные: имя, телефон, адрес электронной почты (email), данные платёжной карты, cookie.</p>
          <p style="margin-bottom: 8px;">4.2. Персональные данные используются исключительно для регистрации, аналитики, исполнения заказа, а также для обеспечения функционирования Сайта.</p>
          <p style="margin-bottom: 8px;">4.3. Данные не передаются третьим лицам, за исключением передачи платёжных данных в банк для проведения оплаты.</p>
          <p style="margin-bottom: 16px;">4.4. Пользователь, оформляя заказ, выражает согласие на обработку своих персональных данных в указанных целях.</p>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">5. Оформление и оплата заказа</h2>
          <p style="margin-bottom: 8px;">5.1. Пользователь оформляет предзаказ на Сайте, выбирая Заведение-партнёр и товары/услуги.</p>
          <p style="margin-bottom: 8px;">5.2. Оплата осуществляется через интернет-эквайринг Альфа-Банка с использованием платёжной карты.</p>
          <p style="margin-bottom: 8px;">5.3. Пользователь вносит предоплату, которая передаётся выбранному заведению.</p>
          <p style="margin-bottom: 16px;">5.4. Порядок возврата денежных средств определяется политикой соответствующего Заведения-партнёра.</p>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">6. Использование контента и сторонних сервисов</h2>
          <p style="margin-bottom: 8px;">6.1. На Сайте размещаются фото и видео товаров заведений, предоставленные самими заведениями или созданные с помощью искусственного интеллекта.</p>
          <p style="margin-bottom: 16px;">6.2. На Сайте используется карта с API Яндекс.Карт. Пользователь соглашается с условиями использования данного сервиса.</p>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">7. Ограничение ответственности</h2>
          <p style="margin-bottom: 8px;">7.1. Администрация Сайта не несёт ответственности за качество товаров/услуг, предоставляемых Заведениям-партнёрами, а также за действия третьих лиц.</p>
          <p style="margin-bottom: 16px;">7.2. Администрация Сайта не отвечает за возможные сбои в работе интернет-эквайринга, Яндекс.Карт или других сторонних сервисов.</p>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">8. Поддержка и разрешение споров</h2>
          <p style="margin-bottom: 8px;">8.1. В случае возникновения вопросов или претензий Пользователь вправе обратиться в отдел поддержки Сайта через форму обратной связи или по указанным контактам.</p>
          <p style="margin-bottom: 8px;">8.2. Все претензии рассматриваются в претензионном порядке.</p>
          <p style="margin-bottom: 16px;">8.3. В случае невозможности разрешения спора в претензионном порядке, спор подлежит рассмотрению в суде по месту регистрации Администрации Сайта.</p>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">9. Изменение условий соглашения</h2>
          <p style="margin-bottom: 8px;">9.1. Администрация Сайта вправе вносить изменения в настоящее Соглашение в одностороннем порядке.</p>
          <p style="margin-bottom: 8px;">9.2. Новая редакция Соглашения вступает в силу с момента публикации на Сайте.</p>
          <p style="margin-bottom: 16px;">9.3. Продолжение использования Сайта после внесения изменений означает согласие Пользователя с новой редакцией Соглашения.</p>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">10. Прочие условия</h2>
          <p style="margin-bottom: 8px;">10.1. Настоящее Соглашение действует бессрочно до момента его замены новой редакцией.</p>
          <p style="margin-bottom: 16px;">10.2. Недействительность отдельных положений Соглашения не влечёт недействительности всего Соглашения в целом.</p>

          <div style="margin-top: 24px;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Контактная информация Администрации Сайта:</h3>
            <p style="margin-bottom: 16px;">paimetov.k@mail.ru</p>
          </div>

          <div style="margin-top: 24px;">
            <p style="margin-bottom: 8px;">Дата публикации: 04.06.2025</p>
          </div>

          <div style="margin-top: 24px; padding: 16px; background-color: var(--tg-theme-secondary-bg-color, rgba(0, 0, 0, 0.05)); border-radius: 8px;">
            <p style="font-weight: 600; margin-bottom: 8px;">Внимание!</p>
            <p>Перед использованием Сайта внимательно ознакомьтесь с условиями настоящего Соглашения. Оформление заказа на Сайте означает полное и безоговорочное согласие с его условиями.</p>
          </div>
        </div>
      `;
      
      // Update sidebar content
      document.getElementById('sidebarContent').innerHTML = agreementContent;
    }
    
    // Setup dropdown menu
    function setupDropdownMenu() {
      const titleDropdownToggle = document.getElementById('titleDropdownToggle');
      const titleDropdown = document.getElementById('titleDropdown');
      const dropdownItems = document.querySelectorAll('.dropdown-item');
      
      // Toggle dropdown on click
      titleDropdownToggle.addEventListener('click', function(event) {
        // Prevent the click from being handled by the document click handler
        event.stopPropagation();
        titleDropdown.classList.toggle('visible');
      });
      
      // Close dropdown when clicking outside
      document.addEventListener('click', function(event) {
        titleDropdown.classList.remove('visible');
      });
      
      // Handle dropdown item click
      dropdownItems.forEach(item => {
        item.addEventListener('click', function(event) {
          // Prevent event bubbling
          event.stopPropagation();
          
          // Get venue type
          const venueType = this.dataset.type;
          
          // Update current venue type
          currentVenueType = venueType;
          
          // Update dropdown text
          document.getElementById('currentVenueType').textContent = venueType === 'coffee' ? 'Кофейни Кирова' : 'Шаурмичные Кирова';
          
          // Update active item
          dropdownItems.forEach(item => {
            item.classList.remove('active');
          });
          this.classList.add('active');
          
          // Close dropdown
          titleDropdown.classList.remove('visible');
          
          // Update sidebar title
          document.getElementById('sidebarTitle').textContent = venueType === 'coffee' ? 'Кофейни Кирова' : 'Шаурмичные Кирова';
          
          // Load venues
          loadVenues();
        });
      });
    }

    // Get user data from Telegram
    function getUserDataFromTelegram() {
      if (tg && tg.initDataUnsafe && tg.initDataUnsafe.user) {
        const user = tg.initDataUnsafe.user;
        
        // Update user data
        userData.name = user.first_name + (user.last_name ? ' ' + user.last_name : '');
        userData.id = user.id.toString();
        
        // Get user phone if available
        if (user.phone_number) {
          userData.phone = user.phone_number;
        }
        
        // Get user avatar if available
        if (user.photo_url) {
          userData.avatar = user.photo_url;
        }
        
        // Generate referral code
        generateReferralCode();
        
        // Update sidebar
        showMainMenu();
      }
    }
    
    // Make functions available globally
    window.openPreorderForm = openPreorderForm;
    window.openPreorderFormFromInfo = openPreorderFormFromInfo;
    window.hideOverlay = hideOverlay;
    window.selectCoffee = selectCoffee;
    window.toggleExtra = toggleExtra;
    window.updateTotalPrice = updateTotalPrice;
    window.submitOrder = submitOrder;
    window.openSidebar = openSidebar;
    window.closeSidebar = closeSidebar;
    window.showMainMenu = showMainMenu;
    window.showOrders = showOrders;
    window.showReferral = showReferral;
    window.copyReferralCode = copyReferralCode;

    // Show privacy policy
    function showPrivacyPolicy() {
      // Update sidebar title
      document.getElementById('sidebarTitle').textContent = 'Политика обработки данных';
      
      // Show back button
      document.getElementById('sidebarBack').style.visibility = 'visible';
      
      // Create privacy policy content
      const privacyContent = `
        <div style="padding: 20px;">
          <h1 style="font-size: 20px; font-weight: 600; margin-bottom: 20px;">Политика обработки персональных данных для vkusnobot.ru</h1>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">1. Общие положения</h2>
          <p style="margin-bottom: 8px;">1.1. Политика регулирует порядок обработки персональных данных пользователей сайта vkusnobot.ru в соответствии с ФЗ-152 «О персональных данных».</p>
          <p style="margin-bottom: 16px;">1.2. Оформление заказа на сайте является подтверждением согласия на обработку данных.</p>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">2. Состав данных и цели обработки</h2>
          <div style="margin-bottom: 16px;">
            <p style="font-weight: 600; margin-bottom: 8px;">Собираемые данные:</p>
            <ul style="list-style: none; padding-left: 0;">
              <li style="margin-bottom: 4px;">• Имя, телефон, email;</li>
              <li style="margin-bottom: 4px;">• Платёжные реквизиты карты (обрабатываются через эквайринг Альфа-Банка);</li>
              <li style="margin-bottom: 4px;">• Геолокация (через API Яндекс.Карт);</li>
              <li style="margin-bottom: 4px;">• Данные профиля Telegram (при входе через бота);</li>
              <li style="margin-bottom: 4px;">• Cookie (идентификаторы сессий, аналитика).</li>
            </ul>
          </div>

          <div style="margin-bottom: 16px;">
            <p style="font-weight: 600; margin-bottom: 8px;">Цели обработки:</p>
            <ul style="list-style: none; padding-left: 0;">
              <li style="margin-bottom: 4px;">• Исполнение заказа;</li>
              <li style="margin-bottom: 4px;">• Аналитика посещаемости;</li>
              <li style="margin-bottom: 4px;">• Обеспечение безопасности транзакций.</li>
            </ul>
          </div>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">3. Правовые основания и сроки хранения</h2>
          <p style="margin-bottom: 8px;">3.1. Обработка осуществляется на основании:</p>
          <ul style="list-style: none; padding-left: 0; margin-bottom: 16px;">
            <li style="margin-bottom: 4px;">• Публичной оферты (ст. 437 ГК РФ);</li>
            <li style="margin-bottom: 4px;">• Согласия, выраженного действием (оформление заказа).</li>
          </ul>
          <p style="margin-bottom: 16px;">3.2. Данные хранятся до отзыва согласия. При отзыве — уничтожаются в течение 30 дней после обращения в поддержку.</p>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">4. Права пользователей</h2>
          <p style="margin-bottom: 8px;">4.1. Пользователь вправе:</p>
          <ul style="list-style: none; padding-left: 0; margin-bottom: 16px;">
            <li style="margin-bottom: 4px;">• Отозвать согласие (через обращение в поддержку);</li>
            <li style="margin-bottom: 4px;">• Запросить доступ, исправление или удаление данных;</li>
            <li style="margin-bottom: 4px;">• Подать жалобу в Роскомнадзор.</li>
          </ul>
          <p style="margin-bottom: 16px;">4.2. Для удаления данных отправьте запрос на support@vkusnobot.ru.</p>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">5. Меры безопасности</h2>
          <p style="margin-bottom: 8px;">5.1. Применяемые технологии:</p>
          <ul style="list-style: none; padding-left: 0; margin-bottom: 16px;">
            <li style="margin-bottom: 4px;">• Шифрование данных (SSL/TLS);</li>
            <li style="margin-bottom: 4px;">• Токенизация платёжных реквизитов;</li>
            <li style="margin-bottom: 4px;">• Регулярное тестирование систем защиты.</li>
          </ul>
          <p style="margin-bottom: 16px;">5.2. Данные хранятся на серверах на территории РФ.</p>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">6. Использование cookie</h2>
          <p style="margin-bottom: 8px;">6.1. Сайт использует необходимые cookie (сессии, аутентификация). Отключение может ограничить функционал.</p>
          <p style="margin-bottom: 16px;">6.2. Отдельное согласие на cookie не требуется.</p>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">7. Интеграция с Telegram</h2>
          <p style="margin-bottom: 8px;">7.1. При входе через Telegram-бота собирается:</p>
          <ul style="list-style: none; padding-left: 0; margin-bottom: 16px;">
            <li style="margin-bottom: 4px;">• Имя профиля;</li>
            <li style="margin-bottom: 4px;">• ID аккаунта.</li>
          </ul>
          <p style="margin-bottom: 16px;">7.2. Данные используются только для авторизации.</p>

          <h2 style="font-size: 18px; font-weight: 600; margin: 20px 0 12px;">8. Обновление политики</h2>
          <p style="margin-bottom: 8px;">8.1. Изменения публикуются в разделе «Новости» на сайте.</p>
          <p style="margin-bottom: 16px;">8.2. При продолжении использования сервиса после изменений пользователь считается согласным с новой редакцией.</p>

          <div style="margin-top: 24px;">
            <h3 style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Контактные данные для запросов:</h3>
            <p style="margin-bottom: 16px;">Email: support@vkusnobot.ru</p>
          </div>

          <div style="margin-top: 24px;">
            <p style="margin-bottom: 8px;">Дата вступления в силу: 04 июня 2025 г.</p>
          </div>
        </div>
      `;
      
      // Update sidebar content
      document.getElementById('sidebarContent').innerHTML = privacyContent;
    }

    // Contact options modal
    const contactOptionsHTML = `
      <div id="contactOverlay" class="contact-overlay" onclick="hideContactOptions()"></div>
      <div id="contactOptions" class="contact-options">
        <div class="contact-title">Связаться с нами</div>
        <button class="contact-close" onclick="hideContactOptions()">&times;</button>
        <a href="https://t.me/paiagent" class="contact-option" target="_blank">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.2-1.3l15.97-6.16c.73-.33 1.43.18 1.15 1.3l-2.72 12.81c-.19.91-.74 1.13-1.5.71L12.6 16.3l-1.99 1.93c-.23.23-.42.42-.83.42z"/>
          </svg>
          Telegram
        </a>
        <a href="mailto:support@vkusnobot.ru" class="contact-option">
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
          </svg>
          Email
        </a>
      </div>
    `;

    // Add contact options to body
    document.body.insertAdjacentHTML('beforeend', contactOptionsHTML);

    // Make functions available globally
    window.hideContactOptions = hideContactOptions;

    // Function to show success message
    function showSuccess(message) {
      const notification = document.createElement('div');
      notification.className = 'success';
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => {
        notification.remove();
      }, 3000);
    }

    // Function to show error message
    function showError(message) {
      const notification = document.createElement('div');
      notification.className = 'error';
      notification.textContent = message;
      document.body.appendChild(notification);
      setTimeout(() => {
        notification.remove();
      }, 5000);
    }

    // Function to send order to new site
    function sendOrderToNewSite(orderData) {
      // Добавляем дополнительные поля если их нет
      const completeOrderData = {
        shop_name: orderData.shop_name || currentShop?.name || "Неизвестное заведение",
        shop_address: orderData.shop_address || currentShop?.address || "",
        shop_hours: orderData.shop_hours || currentShop?.hours || "",
        items: orderData.items || [],
        pickup_time: orderData.pickup_time || 15,
        comment: orderData.comment || "",
        total_price: orderData.total_price || totalPrice || 0,
        order_id: orderData.order_id || Math.floor(Math.random() * 100000),
        customer_name: orderData.customer_name || userData?.name || "Клиент",
        customer_phone: orderData.customer_phone || userData?.phone || ""
      };

      console.log('Отправляем заказ:', completeOrderData);

      // Отправка только на вебхук
      fetch('https://v0-site-for-order-imports.vercel.app/api/webhook', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(completeOrderData)
      })
      .then(response => {
        console.log('Webhook Response status:', response.status);
        return response.json();
      })
      .then(data => {
        console.log('Заказ успешно отправлен:', data);
        if (data.success) {
          showSuccess('Заказ успешно отправлен в систему управления');
        }
      })
      .catch(error => {
        console.error('Ошибка отправки заказа:', error);
        showError('Ошибка отправки заказа в систему управления');
      });
    }

    // Submit order with pickup time
    function submitOrder() {
      // Проверяем, выбран ли хотя бы один товар
      const specialDrinks = ['americano', 'cappuccino', 'latte', 'espresso'];
      const hasSpecialDrink = specialDrinks.some(drinkId => 
        document.querySelector(`.menu-item[data-id="${drinkId}"].selected`)
      );
      
      if (!selectedDrink && !selectedDessert && !selectedSandwich && !selectedIcecream && !hasSpecialDrink) {
        console.log('No items selected');
        return;
      }
      
      // Get form data
      const comment = document.getElementById('comment').value;
      const pickupTime = document.getElementById('timeSlider').value;
      
      // Create order object
      const order = {
        shop: currentShop,
        items: [],
        comment,
        pickupTime: parseInt(pickupTime),
        totalPrice,
        timestamp: new Date().toISOString()
      };
      
      // Add selected drink if any
      if (selectedDrink) {
        order.items.push({
          type: 'drink',
          name: selectedDrink.name,
          extras: selectedExtras,
          price: selectedDrink.price
        });
      }
      
      // Добавляем американо, капучино, латте и эспрессо, если они выбраны
      const specialDrinksList = [
        { id: 'americano', name: 'Американо' },
        { id: 'cappuccino', name: 'Капучино' },
        { id: 'latte', name: 'Латте' },
        { id: 'espresso', name: 'Эспрессо' }
      ];
      
      specialDrinksList.forEach(drink => {
        const element = document.querySelector(`.menu-item[data-id="${drink.id}"]`);
        if (element && element.classList.contains('selected')) {
          order.items.push({
            type: 'drink',
            name: drink.name,
            extras: [],
            price: parseInt(element.dataset.price)
          });
        }
      });
      
      // Add selected dessert if any
      if (selectedDessert) {
        order.items.push({
          type: 'dessert',
          name: selectedDessert.name,
          price: selectedDessert.price
        });
      }

      // Add selected sandwich if any
      if (selectedSandwich) {
        order.items.push({
          type: 'sandwich',
          name: selectedSandwich.name,
          price: selectedSandwich.price
        });
      }

      // Add selected ice cream if any
      if (selectedIcecream) {
        order.items.push({
          type: 'icecream',
          name: selectedIcecream.name,
          price: selectedIcecream.price
        });
      }
      
      // Add to user's orders history
      const now = new Date();
      const newOrder = {
        id: Math.floor(Math.random() * 100000),
        date: now.toISOString().split('T')[0],
        time: now.toTimeString().split(' ')[0].substring(0, 5),
        shop: order.shop.name,
        items: order.items.map(item => {
          if (item.type === 'drink') {
            return `${item.name}${item.extras.length > 0 ? ` + ${item.extras.map(e => e.name).join(', ')}` : ''}`;
          } else {
            return item.name;
          }
        }),
        pickupTime: order.pickupTime,
        total: totalPrice
      };
      
      userData.orders.unshift(newOrder);

      // Prepare order data for new site
      const orderData = {
        shop_name: currentShop.name,
        shop_address: currentShop.address,
        shop_hours: currentShop.hours,
        items: order.items,
        pickup_time: order.pickupTime,
        comment: comment,
        total_price: totalPrice,
        order_id: newOrder.id,
        customer_name: userData.name,
        customer_phone: userData.phone
      };
      
      // Send order to new site
      sendOrderToNewSite(orderData);
      
      // Show success message
      showOrderSuccess(order);
      
      // Send data to Telegram Mini App if available
      if (tg) {
        tg.sendData(JSON.stringify({
          shop_name: order.shop.name,
          shop_address: order.shop.address,
          shop_hours: order.shop.hours,
          items: order.items,
          pickup_time: order.pickupTime,
          comment: comment,
          total_price: totalPrice,
          order_id: newOrder.id
        }));
      }
    }
  </script>
  
  <div style="
    padding: 15px;
    text-align: center;
    background-color: var(--tg-theme-bg-color, #ffffff);
    color: var(--tg-theme-hint-color, #999999);
    font-size: 12px;
    border-top: 1px solid var(--tg-theme-hint-color, rgba(0, 0, 0, 0.1));
  ">
    ИП Пайметов Кирилл Евгеньевич ОГРНИП 325430000027633 ИНН 434585647865
  </div>

  <!-- Contact overlay -->
  <div id="contactOverlay" class="contact-overlay" onclick="hideContactOptions()"></div>

  <!-- Contact options -->
  <div id="contactOptions" class="contact-options">
    <div class="contact-title">Связаться с нами</div>
    <button class="contact-close" onclick="hideContactOptions()">&times;</button>
    <a href="https://t.me/paiagent" class="contact-option" target="_blank">
      <svg viewBox="0 0 24 24" fill="currentColor">
        <path d="M9.78 18.65l.28-4.23 7.68-6.92c.34-.31-.07-.46-.52-.19L7.74 13.3 3.64 12c-.88-.25-.89-.86.2-1.3l15.97-6.16c.73-.33 1.43.18 1.15 1.3l-2.72 12.81c-.19.91-.74 1.13-1.5.71L12.6 16.3l-1.99 1.93c-.23.23-.42.42-.83.42z"/>
      </svg>
      Telegram
    </a>
    <a href="https://wa.me/+79052661118" class="contact-option whatsapp" target="_blank">
      <svg viewBox="0 0 24 24">
        <path d="M12.031 6.172c-3.181 0-5.767 2.586-5.768 5.766-.001 1.298.38 2.27 1.019 3.287l-.582 2.128 2.182-.573c.978.58 1.911.928 3.145.929 3.178 0 5.767-2.587 5.768-5.766.001-3.187-2.575-5.77-5.764-5.771zm3.392 8.244c-.144.405-.837.774-1.17.824-.299.045-.677.063-1.092-.069-.252-.08-.575-.187-.988-.365-1.739-.751-2.874-2.502-2.961-2.617-.087-.116-.708-.94-.708-1.793s.448-1.273.607-1.446c.159-.173.346-.217.462-.217l.332.006c.106.005.249-.04.39.298.144.347.491 1.2.534 1.287.043.087.072.188.014.304-.058.116-.087.188-.173.289l-.26.304c-.087.086-.177.18-.076.354.101.174.449.741.964 1.201.662.591 1.221.774 1.394.86s.274.072.376-.043c.101-.116.433-.506.549-.68.116-.173.231-.145.39-.087s1.011.477 1.184.564.289.13.332.202c.045.072.045.419-.1.824zm-3.423-14.416c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm.029 18.88c-1.161 0-2.305-.292-3.318-.844l-3.677.964.984-3.595c-.607-1.052-.927-2.246-.926-3.468.001-3.825 3.113-6.937 6.937-6.937 1.856.001 3.598.723 4.907 2.034 1.31 1.311 2.031 3.054 2.03 4.908-.001 3.825-3.113 6.938-6.937 6.938z"/>
      </svg>
      WhatsApp
    </a>
    <a href="mailto:support@vkusnobot.ru" class="contact-option email">
      <svg viewBox="0 0 24 24">
        <path d="M20 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"/>
      </svg>
      Email
    </a>
  </div>
</body>
</html>

